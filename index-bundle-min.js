global=this,function(t){function e(t,e,n,r,s){this.id=t,this.dirname=e,this.filename=e+"/"+n,this.dependencies=r,this.factory=s}for(var n,r={},s=0;s<t.length;s++){var o=t[s];o=t[s]=new e(o[0],o[1],o[2],o[3],o[4]),r[o.filename]=o}return e.prototype._require=function(){var e=this;if(void 0===e.exports){e.exports={};var r=function(n){var r=e.dependencies[n],s=t[r];if(!s)throw new Error("Bundle is missing a dependency: "+n);return s._require()};r.main=n,e.exports=e.factory(r,e.exports,e,e.filename,e.dirname)||e.exports}return e.exports},e.prototype.modules=r,function(t){n=r[t],n._require()}}([["base64.js","Base64","base64.js",{},function(t,e,n,r,s){!function(){function t(t){this.message=t}var n="undefined"!=typeof e?e:this,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";t.prototype=new Error,t.prototype.name="InvalidCharacterError",n.btoa||(n.btoa=function(e){for(var n,s,o=String(e),i=0,a=r,u="";o.charAt(0|i)||(a="=",i%1);u+=a.charAt(63&n>>8-i%1*8)){if(s=o.charCodeAt(i+=.75),s>255)throw new t("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.");n=n<<8|s}return u}),n.atob||(n.atob=function(e){var n=String(e).replace(/=+$/,"");if(n.length%4==1)throw new t("'atob' failed: The string to be decoded is not correctly encoded.");for(var s,o,i=0,a=0,u="";o=n.charAt(a++);~o&&(s=i%4?64*s+o:o,i++%4)?u+=String.fromCharCode(255&s>>(-2*i&6)):0)o=r.indexOf(o);return u})}()}],["animator.js","blick","animator.js",{raf:40},function(t,e,n,r,s){"use strict";function o(t){var e=this;e._requestAnimation=t||a,e.controllers=[],e._animate=function(){try{e.animate(Date.now())}catch(t){throw e.requestAnimation(),t}}}function i(t,e){this.component=t,this.controller=e,this.measure=!1,this.transition=!1,this.animate=!1,this.draw=!1,this.redraw=!1}var a=t("raf");n.exports=o,o.prototype.requestAnimation=function(){this.requested||this._requestAnimation(this._animate),this.requested=!0},o.prototype.animate=function(t){this.requested=!1;for(var e=0;e<this.controllers.length;e++){var n=this.controllers[e];n.measure&&(n.component.measure(t),n.measure=!1)}for(var e=0;e<this.controllers.length;e++){var n=this.controllers[e];n.transition&&(n.draw||n.redraw?this.requestAnimation():(n.component.transition(t),n.transition=!1))}for(var e=0;e<this.controllers.length;e++){var n=this.controllers[e];n.animate&&(n.component.animate(t),this.requestAnimation())}for(var e=0;e<this.controllers.length;e++){var n=this.controllers[e];n.draw&&(n.component.draw(t),n.draw=!1)}for(var e=0;e<this.controllers.length;e++){var n=this.controllers[e];n.redraw&&(n.component.redraw(t),n.redraw=!1)}},o.prototype.add=function(t){var e=new i(t,this);return this.controllers.push(e),e},i.prototype.destroy=function(){},i.prototype.requestMeasure=function(){if(!this.component.measure)throw new Error("Can't requestMeasure because component does not implement measure");this.measure=!0,this.controller.requestAnimation()},i.prototype.cancelMeasure=function(){this.measure=!1},i.prototype.requestTransition=function(){if(!this.component.transition)throw new Error("Can't requestTransition because component does not implement transition");this.transition=!0,this.controller.requestAnimation()},i.prototype.cancelTransition=function(){this.transition=!1},i.prototype.requestAnimation=function(){if(!this.component.animate)throw new Error("Can't requestAnimation because component does not implement animate");this.animate=!0,this.controller.requestAnimation()},i.prototype.cancelAnimation=function(){this.animate=!1},i.prototype.requestDraw=function(){if(!this.component.draw)throw new Error("Can't requestDraw because component does not implement draw");this.draw=!0,this.controller.requestAnimation()},i.prototype.cancelDraw=function(){this.draw=!1},i.prototype.requestRedraw=function(){if(!this.component.redraw)throw new Error("Can't requestRedraw because component does not implement redraw");this.redraw=!0,this.controller.requestAnimation()},i.prototype.cancelRedraw=function(){this.redraw=!1}}],["ready.js","domready","ready.js",{},function(t,e,n,r,s){!function(t,e){"undefined"!=typeof n?n.exports=e():"function"==typeof define&&"object"==typeof define.amd?define(e):this[t]=e()}("domready",function(){var t,e=[],n=document,r=n.documentElement.doScroll,s="DOMContentLoaded",o=(r?/^loaded|^c/:/^loaded|^i|^c/).test(n.readyState);return o||n.addEventListener(s,t=function(){for(n.removeEventListener(s,t),o=1;t=e.shift();)t()}),function(t){o?setTimeout(t,0):e.push(t)}})}],["window.js","global","window.js",{},function(t,e,n,r,s){"undefined"!=typeof window?n.exports=window:"undefined"!=typeof global?n.exports=global:"undefined"!=typeof self?n.exports=self:n.exports={}}],["document.js","gutentag","document.js",{koerper:37},function(t,e,n,r,s){"use strict";n.exports=t("koerper")}],["scope.js","gutentag","scope.js",{},function(t,e,n,r,s){"use strict";function o(){this.root=this,this.components=Object.create(null),this.componentsFor=Object.create(null)}n.exports=o,o.prototype.nest=function(){var t=Object.create(this);return t.parent=this,t.caller=this.caller&&this.caller.nest(),t},o.prototype.nestComponents=function(){var t=this.nest();return t.components=Object.create(this.components),t.componentsFor=Object.create(this.componentsFor),t},o.prototype.set=function(t,e){console.log((new Error).stack),this.hookup(t,e)},o.prototype.hookup=function(t,e){var n=this;n.components[t]=e,n["this"].hookup?n["this"].hookup(t,e,n):n["this"].add&&n["this"].add(e,t,n);var r=n["this"].exports&&n["this"].exports[t];if(r){var s=n.caller.id;n.caller.hookup(s+":"+r,e)}}}],["text.html","gutentag","text.html",{"./text":7},function(t,e,n,r,s){"use strict";n.exports=t("./text")}],["text.js","gutentag","text.js",{},function(t,e,n,r,s){"use strict";function o(t,e){var n=t.ownerDocument.createTextNode("");t.appendChild(n),this.node=n,this.defaultText=e.argument.innerText,this._value=null}n.exports=o,Object.defineProperty(o.prototype,"value",{get:function(){return this._value},set:function(t){this._value=t,null==t?this.node.data=this.defaultText:this.node.data=""+t}})}],["index.js","hashbind","index.js",{rezult:41},function(t,e,n,r,s){"use strict";function o(t,e){function n(t){r.load()}var r=this;e||(e={}),this.window=t,this.last="",this.cache={},this.values={},this.bound={},this.decode=e.decode||o.decodeUnescape,this.encode=e.encode||(e.escape?o.encodeMaxEscape:o.encodeMinEscape),this.window.addEventListener("hashchange",n),this.load()}function i(t,e){this.hash=t,this.key=e,this.def=void 0,this.value=t.values[e],this.parse=u,this.valToString=a,this.listener=null,this.listeners=[],this.notify=this.notifyNoop}function a(t){return t===!1?void 0:t===!0?"":""+t}function u(t){return""===t||"true"===t?new p(null,!0):"false"===t?new p(null,!1):"null"===t?new p(null,null):new p(null,t)}function l(t){return t.replace(/[#=&]/g,h)}function h(t){return escape(t)}var p=t("rezult");n.exports=o,o.decodeUnescape=function(t){for(var e=[],n=t.split("&"),r=0;r<n.length;r++){var s=n[r].split("="),o=unescape(s[0]),i=unescape(s[1])||"";e.push([o,i])}return e},o.encodeMinEscape=function(t){for(var e=[],n=0;n<t.length;n++){var r=t[n][0],s=t[n][1],o=""+l(r);void 0!==s&&""!==s&&(o+="="+l(s)),e.push(o)}return e.join("&")},o.encodeMaxEscape=function(t){for(var e=[],n=0;n<t.length;n++){var r=t[n][0],s=t[n][1],o=""+escape(r);void 0!==s&&""!==s&&(o+="="+escape(s)),e.push(o)}return e.join("&")},o.prototype.load=function(){if(this.window.location.hash!==this.last){this.last=this.window.location.hash;for(var t=this.decode(this.last.slice(1)),e={},n=0;n<t.length;n++){var r=t[n][0],s=t[n][1];if(this.cache[r]!==s)if(this.cache[r]=s,this.bound[r])this.bound[r].onChange();else{var o=u(s);o.err||(this.values[r]=o.value)}e[r]=!0}this.prune(e)}},o.prototype.prune=function(t){t||(t={});for(var e=Object.keys(this.cache),n=0;n<e.length;n++){var r=e[n];t[r]||(this.bound[r]?this.bound[r].reset():(delete this.cache[r],delete this.values[r]))}},o.prototype.save=function(){for(var t=[],e=Object.keys(this.cache),n=0;n<e.length;n++){var r=e[n];this.bound[r]||(this.cache[r]=a(this.values[r]));var s=this.cache[r];t.push([r,s])}var o=this.encode(t);o&&(o="#"+o),this.window.location.hash=this.last=o},o.prototype.bind=function(t){if(this.bound[t])throw new Error("key already bound");var e=new i(this,t);return this.bound[t]=e,e},o.prototype.getStr=function(t){return this.cache[t]},o.prototype.get=function(t){return this.values[t]},o.prototype.set=function(t,e,n){var r=this.bound[t]||this.bind(t);return r.set(e,n)},i.prototype.load=function(){var t=this.hash.cache[this.key];if(void 0!==t){var e=this.parse(t);if(e.err)return this;var n=e.value;this.value!==n&&(this.value=n,this.hash.values[this.key]=this.value,this.notify())}return this},i.prototype.save=function(){this.hash.values[this.key]=this.value;var t=this.valToString(this.value);return this.hash.cache[this.key]!==t&&(this.hash.cache[this.key]=t,this.hash.save()),this},i.prototype.notifyNoop=function(){return this},i.prototype.notifyOne=function(){return this.listener(this.value),this},i.prototype.notifyAll=function(){for(var t=0;t<this.listeners.length;t++)this.listeners[t].call(this,this.value);return this},i.prototype.setParse=function(t,e){return this.parse=t||u,this.load(),e&&this.setToString(e),this},i.prototype.setToString=function(t){return this.valToString=t,void 0!==this.value&&this.save(),this},i.prototype.addListener=function(t){return this.listeners.length?this.listeners.push(t):this.listener?(this.listeners=[this.listener,t],this.listener=null,this.notify=this.notifyAll):(this.listener=t,this.notify=this.notifyOne),void 0!==this.value&&this.notify(),this},i.prototype.setDefault=function(t){var e=null;return e="string"==typeof t?this.parse(t).toValue():t,this.def=e,void 0===this.value&&(this.value=this.def,this.save()),this},i.prototype.onChange=function(){this.load()},i.prototype.get=function(){return this.value},i.prototype.reset=function(){return this.value!==this.def&&(this.value=this.def,this.save()),this},i.prototype.set=function(t,e){var n=null;if("string"==typeof t){var r=this.parse(t);if(e){if(e(r.err,t,r.value),r.err)return void 0;n=r.value}else n=r.toValue()}else n=t;return this.value!==n&&(this.value=n,this.notify(),this.save()),this.value}}],["colorgen.js","hexant","colorgen.js",{rezult:41,husl:36},function(t,e,n,r,s){"use strict";function o(t){var e=/^(\w+)(?:\((.*)\))?$/.exec(t);if(!e)return l.error(new Error("invalid color spec"));var n=e[1],r=p[n];if(!r){var s=Object.keys(p).sort().join(", ");return l.error(new Error("no such color scheme "+JSON.stringify(n)+", valid choices: "+s))}var o=e[2]?e[2].split(/, */):[];return l.lift(r).apply(null,o)}function i(t){return t.genString||"hue"}function a(t,e){function n(n){var r=t*(1+(n-1)/3)%360;return function(t){for(var n=100/(t+1),s=[],o=n,i=0;t>i;o+=n,i++)s.push(h.toHex(r,e,o));return s}}return t=parseInt(t,10)||0,e=parseInt(e,10)||100,0===t&&(t=360),n.genString="light("+t.toString()+", "+e.toString()+")",n}function u(t,e){function n(n){var o=(t+r*n).toFixed(1)+"%",i=(e+s*n).toFixed(1)+"%",a=", "+o+", "+i+")";return function(t){for(var e=360/t,n=[],r=0;t>r;r++){var s=Math.round(r*e).toString();n.push("hsl("+s+a)}return n}}t=parseInt(t,10)||70,e=parseInt(e,10)||40;var r=t>70?-10:10,s=e>70?-10:10;return n.genString="hue("+t+", "+e+")",n}var l=t("rezult"),h=t("husl"),p={};p.light=a,p.hue=u,n.exports.gens=p,n.exports.parse=o,n.exports.toString=i}],["coord.js","hexant","coord.js",{},function(t,e,n,r,s){"use strict";function o(t,e){return this instanceof o?(this.x=t,void(this.y=e)):new o(t,e)}function i(t,e,n){if(!(this instanceof i))return new i(t,e,n);if(t+e+n!==0)throw new Error("CubePoint invariant violated: "+t+" + "+e+" + "+n+" = "+(t+e+n));this.x=t,this.y=e,this.z=n}function a(t,e){return this instanceof a?(this.q=t,void(this.r=e)):new a(t,e)}function u(t,e){return this instanceof u?(this.topLeft=t?t.toOddQOffset():a(),void(this.bottomRight=e?e.toOddQOffset():a())):new u(t,e)}n.exports.ScreenPoint=o,n.exports.CubePoint=i,n.exports.OddQOffset=a,n.exports.OddQBox=u,o.prototype.type="point.screen",o.prototype.copy=function(){return o(this.x,this.y)},o.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this},o.prototype.toString=function(){return"ScreenPoint("+this.x+", "+this.y+")"},o.prototype.toScreenInto=function(t){return t.x=this.x,t.y=this.y,t},o.prototype.toScreen=function(){return this},o.prototype.scale=function(t){return this.x*=t,this.y*=t,this},o.prototype.mulBy=function(t,e){return this.x*=t,this.y*=e,this},o.prototype.add=function(t){return t.type!==this.type&&(t=t.toScreen()),this.x+=t.x,this.y+=t.y,this},o.prototype.sub=function(t){return t.type!==this.type&&(t=t.toScreen()),this.x-=t.x,this.y-=t.y,this},i.basis=[i(1,-1,0),i(0,-1,1),i(-1,0,1),i(-1,1,0),i(0,1,-1),i(1,0,-1)],i.prototype.type="point.cube",i.prototype.toString=function(){return"CubePoint("+this.x+", "+this.y+", "+this.z+")"},i.prototype.copy=function(){return i(this.x,this.y,this.z)},i.prototype.copyFrom=function(t){return t.type!==this.type?t.toCubeInto(this):(this.x=t.x,this.y=t.y,this.z=t.z,this)},i.prototype.add=function(t){return t.type!==this.type&&(t=t.toCube()),this.x+=t.x,this.y+=t.y,this.z+=t.z,this},i.prototype.sub=function(t){return t.type!==this.type&&(t=t.toCube()),this.x-=t.x,this.y-=t.y,this.z-=t.z,this},i.prototype.toScreenInto=function(t){return t.x=1.5*this.x,t.y=Math.sqrt(3)*(this.z+this.x/2),t},i.prototype.toScreen=function(){return this.toScreenInto(o())},i.prototype.toCubeInto=function(t){return t.x=this.x,t.y=this.y,t.z=this.z,t},i.prototype.toCube=function(){return this},i.prototype.toOddQOffset=function(){var t=this.x,e=this.z+(this.x-(1&this.x))/2;return a(t,e)},a.prototype.type="offset.odd-q",a.prototype.toString=function(){return"OddQOffset("+this.q+", "+this.r+")"},a.prototype.copy=function(){return a(this.q,this.r)},a.prototype.copyFrom=function(t){return t.type!==this.type?this.copyFrom(t.toOddQOffset()):(this.q=t.q,this.r=t.r,this)},a.prototype.add=function(t){return t.type!==this.type&&(t=t.toOddQOffset()),this.q+=t.q,this.r+=t.r,this},a.prototype.sub=function(t){return t.type!==this.type&&(t=t.toOddQOffset()),this.q-=t.q,this.r-=t.r,this},a.prototype.mulBy=function(t,e){return this.q*=t,this.r*=e,this},a.prototype.toScreenInto=function(t){return t.x=1.5*this.q,t.y=Math.sqrt(3)*(this.r+.5*(1&this.q)),t},a.prototype.toScreen=function(){return this.toScreenInto(o())},a.prototype.toOddQOffset=function(){return this},a.prototype.toCubeInto=function(t){return t.x=this.q,t.z=this.r-(this.q-(1&this.q))/2,t.y=-t.x-t.z,t},a.prototype.toCube=function(){return this.toCubeInto(i())},u.prototype.copy=function(){return new u(this.topLeft.copy(),this.bottomRight.copy())},u.prototype.copyFrom=function(t){return this.topLeft.copy(t.topLeft),this.bottomRight.copy(t.bottomRight),this},u.prototype.toString=function(){return"OddQBox("+this.topLeft.toString()+", "+this.bottomRight.toString()+")"},u.prototype.screenCount=function(t){return this.screenCountInto(o())},u.prototype.screenCountInto=function(t){var e=this.bottomRight.q-this.topLeft.q,n=this.bottomRight.r-this.topLeft.r;return t.x=(3*e+1)/4,t.y=n+(e>1?.5:0),t},u.prototype.contains=function(t){var e=t.toOddQOffset();return e.q>=this.topLeft.q&&e.q<this.bottomRight.q&&e.r>=this.topLeft.r&&e.r<this.bottomRight.r},u.prototype.expandTo=function(t){var e=!1,n=t.toOddQOffset();return n.q<this.topLeft.q?(this.topLeft.q=n.q,e=!0):n.q>=this.bottomRight.q&&(this.bottomRight.q=n.q+1,e=!0),n.r<this.topLeft.r?(this.topLeft.r=n.r,e=!0):n.r>=this.bottomRight.r&&(this.bottomRight.r=n.r+1,e=!0),e}}],["hexant.html","hexant","hexant.html",{"./hexant.js":12,"./prompt.html":20},function(t,e,n,r,s){"use strict";var o=t("./hexant.js"),i=t("./prompt.html"),a=function(t,e){o.apply(this,arguments);var n=t.ownerDocument,r=this.scope=e.root.nestComponents();r.caller=e,r["this"]=this;var s,a,l,h=t,p=[];s=n.createElement("CANVAS"),h.appendChild(s),a=s.actualNode,r.hookup("view",a),a.setAttribute&&a.setAttribute("id","view_vd7gb1"),r.componentsFor.view&&r.componentsFor.view.setAttribute("for","view_vd7gb1"),a.setAttribute&&a.setAttribute("class","hexant-canvas"),p[p.length]=h,h=s,s=h,h=p[p.length-1],p.length--,s=n.createBody(),h.appendChild(s),p[p.length]=h,h=s,s={tagName:"prompt"},s.component=u,l=r.nest(),l.argument=s,l.id="prompt",a=new i(h,l),s=h,h=p[p.length-1],p.length--,r.hookup("prompt",a),a.setAttribute&&a.setAttribute("id","prompt_8qt552"),r.componentsFor.prompt&&r.componentsFor.prompt.setAttribute("for","prompt_8qt552"),this.scope.hookup("this",this)};a.prototype=Object.create(o.prototype),a.prototype.constructor=a,a.prototype.exports={},n.exports=a;var u=function(t,e){t.ownerDocument,this.scope=e}}],["hexant.js","hexant","hexant.js",{hashbind:8,Base64:0,rezult:41,"./colorgen.js":9,"./world.js":35,"./view.js":34,"./turmite/index.js":23,"./coord.js":10,"./hextiletree.js":15},function(t,e,n,r,s){"use strict";function o(t,e){function n(){u.playpause()}function r(t){u.onKeyPress(t)}function s(t){return/^b64:/.test(t)&&(t=t.slice(4),t=l(t)),i.decodeUnescape(t)}function o(t){var e=i.encodeMinEscape(t);return e="b64:"+h(e)}var u=this,l=e.window.atob||a.atob,h=e.window.btoa||a.btoa;this.el=null,this.world=null,this.view=null,this.window=e.window,this.hash=new i(this.window,{decode:s}),this.animator=e.animator.add(this),this.lastFrameTime=null,this.frameRate=0,this.frameInterval=0,this.paused=!0,this.prompt=null,this.boundPlaypause=n,this.boundOnKeyPress=r,this.b64EncodeHash=o}n.exports=o;var i=t("hashbind"),a=t("Base64"),u=t("rezult"),l=t("./colorgen.js"),h=t("./world.js"),p=t("./view.js"),c=t("./turmite/index.js"),f=t("./coord.js").OddQOffset,d=t("./hextiletree.js"),m=512;o.prototype.hookup=function(t,e,n){"this"===t&&(this.prompt=n.components.prompt,this.el=n.components.view,this.titleBase=this.window.document.title,this.world=new h,this.view=this.world.addView(new p(this.world,this.el)),this.window.addEventListener("keypress",this.boundOnKeyPress),this.el.addEventListener("click",this.boundPlaypause),this.configure())},o.prototype.configure=function(){var t=this;this.hash.bind("colors").setParse(l.parse,l.toString).setDefault("light").addListener(function(e){t.onColorGenChange(e)}),this.hash.bind("rule").setParse(c.compile).setDefault("ant(L R)").addListener(function(e){t.onRuleChange(e)}),this.hash.bind("frameRate").setParse(u.lift(parseInt)).setDefault(4).addListener(function(e){t.setFrameRate(e)}),this.hash.bind("labeled").setDefault(!1).addListener(function(e){t.view.setLabeled(e),t.view.redraw()}),this.hash.bind("drawUnvisited").setDefault(!1).addListener(function(e){t.view.drawUnvisited=!!e}),this.hash.bind("drawTrace").setDefault(!1).addListener(function(e){t.view.drawTrace=!!e,t.view.redraw()});var e,n;this.hash.get("fullauto")?(e=!0,n=86400):(e=this.hash.get("autoplay"),n=parseInt(this.hash.get("autorefresh"),10)),!isNaN(n)&&n&&this.window.setTimeout(function(){this.window.location.reload()},1e3*n),e&&this.play()},o.prototype.onColorGenChange=function(t){this.view.setColorGen(t),this.view.redraw()},o.prototype.onRuleChange=function(t){this.window.document.title=this.titleBase+": "+t,this.world.ents[0]?this.world.updateEnt(t,0):this.world.addEnt(t),this.reset()},o.prototype.onKeyPress=function(t){if(t.target===this.window.document.documentElement||t.target===this.window.document.body||t.target===this.el)switch(t.keyCode){case 32:this.playpause();break;case 35:this.toggleLabeled();break;case 42:this.pause(),this.reset();break;case 43:this.hash.set("frameRate",2*this.frameRate);break;case 45:this.hash.set("frameRate",Math.max(1,Math.floor(this.frameRate/2)));break;case 46:this.stepit();break;case 66:case 98:this.hash.encode=this.hash.encode===i.encodeMinEscape?this.b64EncodeHash:i.encodeMinEscape,this.hash.save();break;case 67:case 99:this.promptFor("colors","New Colors:"),t.preventDefault();break;case 84:case 116:this.hash.set("drawTrace",!this.view.drawTrace);break;case 47:this.promptFor("rule",c.ruleHelp),t.preventDefault()}},o.prototype.promptFor=function(t,e){function n(e,n,s){return e?void s(null):void r.hash.set(t,n,function(t){s(t)})}var r=this;if(!r.prompt.active()){var s=r.hash.getStr(t);r.prompt.prompt(e,s,n)}},o.prototype.reset=function(){this.world.tile=new d(f(0,0),2,2),this.view.hexGrid.bounds=this.world.tile.boundingBox().copy(),this.view.hexGrid.updateSize();var t=this.world.ents[0];t.state=0,t.dir=0,this.world.tile.centerPoint().toCubeInto(t.pos);var e=this.world.tile.get(t.pos);this.world.tile.set(t.pos,h.FlagVisited|e),this.el.width=this.el.width,this.view.redraw()},o.prototype.animate=function(t){var e=1;if(this.lastFrameTime){var n=t-this.lastFrameTime;e=Math.min(m,n/this.frameInterval)}else this.lastFrameTime=t;this.world.stepn(e),this.lastFrameTime+=e*this.frameInterval},o.prototype.play=function(){this.lastFrameTime=null,this.animator.requestAnimation(),this.paused=!1},o.prototype.pause=function(){this.lastFrameTime=null,this.animator.cancelAnimation(),this.paused=!0},o.prototype.playpause=function(){this.paused?this.play():this.pause()},o.prototype.stepit=function(){this.paused?this.world.step():this.pause()},o.prototype.setFrameRate=function(t){this.frameRate=t,this.frameInterval=1e3/this.frameRate},o.prototype.toggleLabeled=function(){this.hash.set("labeled",!this.view.labeled)},o.prototype.resize=function(t,e){this.view.resize(t,e)}}],["hexgrid.js","hexant","hexgrid.js",{"./coord.js":10},function(t,e,n,r,s){"use strict";function o(t,e,n){this.canvas=t,this.ctxHex=e,this.bounds=n||a(),this.view=u(),this.cell=u(),this.origin=u(),this.avail=u(),this.cellSize=0,this.scratchPoint=u(),this.boundTopLeft=u(),this.cellXYs=new Float64Array(12)}var i=t("./coord.js"),a=i.OddQBox,u=i.ScreenPoint,l=Math.sqrt(3)/2;n.exports=o,o.prototype.internalize=function(t){return t.toScreenInto(this.scratchPoint).sub(this.boundTopLeft)},o.prototype.toScreen=function(t){return this.internalize(t).scale(this.cellSize).add(this.origin)},o.prototype.circCellPath=function(t){var e=this.toScreen(t);return this.ctxHex.ctx2d.arc(e.x,e.y,this.cellSize,0,2*Math.PI),e},o.prototype.cellPath=o.prototype.hexCellPath=function(t){var e=this.toScreen(t);return this.ctxHex.fullWith(e.x,e.y,this.cellXYs),e},o.prototype.resize=function(t,e){this.avail.x=t,this.avail.y=e,this.updateSize()},o.prototype.updateSize=function(){this.bounds.topLeft.toScreenInto(this.boundTopLeft),this.bounds.screenCountInto(this.view),this.cell.x=this.avail.x/this.view.x,this.cell.y=this.avail.y/this.view.y;var t=this.cell.x/2,e=this.cell.y/2/l;e>t?(this.cellSize=t,this.cell.y=this.cell.x*l):(this.cellSize=e,this.cell.x=2*this.cellSize),this.cellSize<=2?this.cellPath=this.circCellPath:(this.cellPath=this.hexCellPath,this.ctxHex.buildFor(this.cellSize,this.cellXYs)),this.origin.copyFrom(this.cell).scale(.5),this.canvas.width=this.cell.x*this.view.x,this.canvas.height=this.cell.y*this.view.y,this.canvas.style.width=this.canvas.width+"px",this.canvas.style.height=this.canvas.height+"px"}}],["hextile.js","hexant","hextile.js",{"./coord.js":10},function(t,e,n,r,s){"use strict";function o(t,e,n){this.origin=t.toOddQOffset(),this.width=e,this.height=n,this.data=new Uint16Array(this.width*this.height)}var i=t("./coord.js"),a=i.OddQOffset,u=i.OddQBox;n.exports=o,o.prototype.boundingBox=function(){return u(this.origin,a(this.width,this.height))},o.prototype.centerPoint=function(){return a(this.origin.q+Math.floor(this.width/2),this.origin.r+Math.floor(this.height/2))},o.prototype.pointToIndex=function(t){var e=t.toOddQOffset();return(e.r-this.origin.r)*this.width+(e.q-this.origin.q)},o.prototype.get=function(t){return this.data[this.pointToIndex(t)]},o.prototype.set=function(t,e){return this.data[this.pointToIndex(t)]=e,e},o.prototype.eachDataPoint=function(t){var e,n=this.origin.q,r=this.origin.r,s=n+this.width,o=r+this.height,i=a(n,r);for(e=0,i.r=r;i.r<o;i.r++)for(i.q=n;i.q<s;i.q++,e++)t(i,this.data[e])}}],["hextiletree.js","hexant","hextiletree.js",{"./coord.js":10,"./hextile.js":14},function(t,e,n,r,s){"use strict";function o(t,e,n){this.root=new i(t,e,n)}function i(t,e,n){this.origin=t,this.width=e,this.height=n,this.tileWidth=Math.floor(this.width/2),this.tileHeight=Math.floor(this.height/2),this.tiles=[null,null,null,null];var r=l(this.origin.q-this.tileWidth,this.origin.r-this.tileHeight),s=l(this.origin.q+this.tileWidth,this.origin.r+this.tileHeight);this.box=h(r,s)}var a=t("./coord.js"),u=t("./hextile.js"),l=a.OddQOffset,h=a.OddQBox;n.exports=o;var p=[3,2,1,0],c=[l(0,0),l(1,0),l(0,1),l(1,1)],f=[l(-1,-1),l(1,-1),l(-1,1),l(1,1)];o.prototype.dump=function(){return this.root.dump()},i.prototype.dump=function(){for(var t=["TreeNode @"+this.origin.toString(),"  box: "+this.box.toString()],e=0;e<this.tiles.length;e++){var n=["null"],r=this.tiles[e];r&&(n=r.dump().split(/\n/)),t.push("["+e+"]: "+n[0]);for(var s=1;s<n.length;s++)t.push("     "+n[s])}return t.join("\n")},u.prototype.dump=function(){for(var t=["Tile @"+this.origin.toString()],e=[],n=0;n<this.data.length;n++)n&&n%this.width===0&&(t.push(e.join(" ")),e=[]),e.push(this.data[n].toString());return t.push(e.join(" ")),t.join("\n")},o.prototype.boundingBox=function(){return this.root.boundingBox()},o.prototype.eachDataPoint=function(t){this.root.eachDataPoint(t)},o.prototype.centerPoint=function(){return this.root.centerPoint()},o.prototype.get=function(t){return this.root.get(t)},o.prototype.set=function(t,e){for(var n=t.toOddQOffset();!this.root.box.contains(n);)this.root=this.root.expand();return this.root._set(n,e)},i.prototype.expand=function(){for(var t=new i(this.origin.copy(),2*this.width,2*this.height),e=0;e<this.tiles.length;e++)t.tiles[e]=this.growTile(e);return t},i.prototype.growTile=function(t){var e=this.tiles[t];return e?e.grow(t):null},u.prototype.grow=function(t){var e=c[t].copy().mulBy(this.width,this.height),n=this.origin.copy().add(e),r=new i(n,2*this.width,2*this.height);return r.tiles[p[t]]=this,r},i.prototype.grow=function(t){var e=f[t].copy().mulBy(this.tileWidth,this.tileHeight),n=this.origin.copy().add(e),r=new i(n,2*this.width,2*this.height);return r.tiles[p[t]]=this,r},i.prototype.boundingBox=function(){return this.box},i.prototype.eachDataPoint=function(t){for(var e=0;e<this.tiles.length;e++){var n=this.tiles[e];n?n.eachDataPoint(t):this._fakeDataPoints(e,t)}},i.prototype._fakeDataPoints=function(t,e){var n=1&t,r=t>>1,s=this.origin.q+(n?0:-this.tileWidth),o=this.origin.r+(r?0:-this.tileHeight),i=s+this.tileWidth,a=o+this.tileHeight,u=l(s,o);for(u.r=o;u.r<a;u.r++)for(u.q=s;u.q<i;u.q++)e(u,0)},i.prototype.centerPoint=function(){return this.origin},i.prototype.get=function(t){var e=t.toOddQOffset();if(!this.box.contains(e))return NaN;var n=e.q<this.origin.q?0:1,r=e.r<this.origin.r?0:1,s=2*r+n,o=this.tiles[s];return o?o.get(t):0},i.prototype.set=function(t,e){var n=t.toOddQOffset();if(!this.box.contains(n))throw new Error("set out of bounds");return this._set(n,e)},i.prototype._set=function(t,e){var n=t.q<this.origin.q?0:1,r=t.r<this.origin.r?0:1,s=2*r+n,o=this.tiles[s];if(!o){var i=l(this.origin.q,this.origin.r);t.q<i.q&&(i.q-=this.tileWidth),t.r<i.r&&(i.r-=this.tileHeight),o=new u(i,this.tileWidth,this.tileHeight),this.tiles[s]=o}return o.set(t,e)}}],["index.js","hexant","index.js",{domready:2,"global/window":3,"gutentag/scope":5,"gutentag/document":4,blick:1,"./main.html":17},function(t,e,n,r,s){"use strict";function o(){var t=new h;t.window=u,t.animator=new c;var e=new p(u.document.body);u.hexant=new f(e.documentElement,t),u.addEventListener("resize",i),i()}function i(){var t=Math.max(l.documentElement.clientWidth,u.innerWidth||0),e=Math.max(l.documentElement.clientHeight,u.innerHeight||0);u.hexant.resize(t,e)}var a=t("domready"),u=t("global/window"),l=u.document,h=t("gutentag/scope"),p=t("gutentag/document"),c=t("blick"),f=t("./main.html");a(o)}],["main.html","hexant","main.html",{"./main.js":18,"./hexant.html":11},function(t,e,n,r,s){"use strict";var o=t("./main.js"),i=t("./hexant.html"),a=function(t,e){o.apply(this,arguments);var n=t.ownerDocument,r=this.scope=e.root.nestComponents();r.caller=e,r["this"]=this;var s,a,l,h=t,p=[];s=n.createBody(),h.appendChild(s),p[p.length]=h,h=s,s={tagName:"hexant"},s.component=u,l=r.nest(),l.argument=s,l.id="view",a=new i(h,l),s=h,h=p[p.length-1],p.length--,r.hookup("view",a),a.setAttribute&&a.setAttribute("id","view_plcwmu"),r.componentsFor.view&&r.componentsFor.view.setAttribute("for","view_plcwmu"),this.scope.hookup("this",this)};a.prototype=Object.create(o.prototype),a.prototype.constructor=a,a.prototype.exports={},n.exports=a;var u=function(t,e){t.ownerDocument,this.scope=e}}],["main.js","hexant","main.js",{},function(t,e,n,r,s){"use strict";function o(){this.view=null}o.prototype.hookup=function(t,e){"view"===t&&(this.view=e)},o.prototype.resize=function(t,e){this.view.resize(t,e)},n.exports=o}],["ngoncontext.js","hexant","ngoncontext.js",{},function(t,e,n,r,s){"use strict";function o(t,e){this.ctx2d=e,this.degree=t,this.offset=0,this.step=2*Math.PI/this.degree,this.cos=null,this.sin=null,this.setOffset(0)}n.exports=o,o.prototype.setOffset=function(t){this.offset=t,this.cos=new Float64Array(this.degree),this.sin=new Float64Array(this.degree);for(var e=t,n=0;n<this.degree;n++)this.cos[n]=Math.cos(e),this.sin[n]=Math.sin(e),e+=this.step},o.prototype.buildFor=function(t,e){for(var n=0,r=0;n<this.degree;n++)e[r++]=t*this.cos[n],e[r++]=t*this.sin[n]},o.prototype.fullWith=function(t,e,n){this.ctx2d.moveTo(t+n[0],e+n[1]);for(var r=1,s=2;r<this.degree;r++)this.ctx2d.lineTo(t+n[s++],e+n[s++])},o.prototype.full=function(t,e,n){if(2>=n)this.ctx2d.arc(t,e,n,0,2*Math.PI);else{this.ctx2d.moveTo(t+n*this.cos[0],e+n*this.sin[0]);for(var r=1;r<this.degree;r++)this.ctx2d.lineTo(t+n*this.cos[r],e+n*this.sin[r])}},o.prototype.arc=function(t,e,n,r,s,o){var i=0,a=0;if("number"==typeof r&&(i=r%this.degree),"number"==typeof s&&(a=s%this.degree),i===a)return void this.full(t,e,n);if(o)return void this.arc(t,e,n,a,this.degree-i,!1);var u=this.degree+a-i;u>this.degree&&(u-=this.degree);var l=i,h=t+n*this.cos[l],p=e+n*this.sin[l];this.ctx2d.moveTo(h,p);for(var c=1;u>=c;c++)l=(l+1)%this.degree,h=t+n*this.cos[l],p=e+n*this.sin[l],this.ctx2d.lineTo(h,p)},o.prototype.wedge=function(t,e,n,r,s,o){var i=0,a=0;if("number"==typeof r&&(i=r%this.degree),"number"==typeof s&&(a=s%this.degree),i===a)return void this.full(t,e,n);if(o)return void this.wedge(t,e,n,a,i,!1);var u=this.degree+a-i;u>this.degree&&(u-=this.degree),this.ctx2d.moveTo(t,e);for(var l=i,h=0;u>=h;h++){var p=t+n*this.cos[l],c=e+n*this.sin[l];this.ctx2d.lineTo(p,c),l=(l+1)%this.degree}}}],["prompt.html","hexant","prompt.html",{"./prompt.js":21,"gutentag/text.html":6},function(t,e,n,r,s){"use strict";var o=t("./prompt.js"),i=(t("gutentag/text.html"),function(t,e){o.apply(this,arguments);var n=t.ownerDocument,r=this.scope=e.root.nestComponents();r.caller=e,r["this"]=this;var s,i,a=t,u=[];s=n.createElement("DIV"),a.appendChild(s),i=s.actualNode,r.hookup("box",i),i.setAttribute&&i.setAttribute("id","box_j4c2lh"),r.componentsFor.box&&r.componentsFor.box.setAttribute("for","box_j4c2lh"),i.setAttribute&&i.setAttribute("class","prompt"),i.setAttribute&&i.setAttribute("style","display: none"),u[u.length]=a,a=s,s=n.createElement("DIV"),a.appendChild(s),i=s.actualNode,r.hookup("help",i),i.setAttribute&&i.setAttribute("id","help_8s4m1l"),r.componentsFor.help&&r.componentsFor.help.setAttribute("for","help_8s4m1l"),i.setAttribute&&i.setAttribute("class","help"),u[u.length]=a,a=s,s=a,a=u[u.length-1],u.length--,s=n.createElement("TEXTAREA"),a.appendChild(s),i=s.actualNode,r.hookup("text",i),i.setAttribute&&i.setAttribute("id","text_3huxb"),r.componentsFor.text&&r.componentsFor.text.setAttribute("for","text_3huxb"),u[u.length]=a,a=s,s=a,a=u[u.length-1],u.length--,s=n.createElement("DIV"),a.appendChild(s),i=s.actualNode,r.hookup("error",i),i.setAttribute&&i.setAttribute("id","error_2kdrzp"),r.componentsFor.error&&r.componentsFor.error.setAttribute("for","error_2kdrzp"),
i.setAttribute&&i.setAttribute("class","error"),i.setAttribute&&i.setAttribute("style","display: none"),u[u.length]=a,a=s,s=a,a=u[u.length-1],u.length--,a.appendChild(n.createTextNode("Press <Ctrl>-Enter to submit.")),s=a,a=u[u.length-1],u.length--,this.scope.hookup("this",this)});i.prototype=Object.create(o.prototype),i.prototype.constructor=i,i.prototype.exports={},n.exports=i}],["prompt.js","hexant","prompt.js",{},function(t,e,n,r,s){"use strict";function o(t,e){function n(t){i.onKeyDown(t)}function r(t){i.onKeyUp(t)}function s(t){i.cancel()}function o(t,e,n){i.finished(t,e,n)}var i=this;this.box=null,this.help=null,this.error=null,this.text=null,this.callback=null,this.boundOnKeyDown=n,this.boundOnKeyUp=r,this.boundCancel=s,this.boundFinished=o,this.lastEnter=0}n.exports=o,o.prototype.active=function(){return!!this.callback},o.prototype.prompt=function(t,e,n){this.help.innerText=t,this.text.value=e,this.callback=n,this.box.style.display="",this.resizeTextRows(),this.text.select(),this.text.focus()},o.prototype.resizeTextRows=function(){var t=this.text.value.split(/\n/);this.text.rows=t.length+1},o.prototype.finish=function(){var t=this.text.value,e=this.callback;e?(t=t.replace(/(?:\r?\n)+$/,""),e(!1,t,this.boundFinished)):this.boundFinished(null)},o.prototype.cancel=function(){var t=this.callback;t&&t(!0,null,this.boundFinished)},o.prototype.finished=function(t,e,n){return t?(this.error.innerText=""+t,this.error.style.display="",e&&(this.help.innerText=e),void(n&&(this.text.value=n))):void this.hide()},o.prototype.hide=function(){this.lastEnter=0,this.box.style.display="none",this.callback=null,this.text.value="",this.help.innerText="",this.error.style.display="none",this.error.innerText=""},o.prototype.hookup=function(t,e,n){"this"===t&&(this.box=n.components.box,this.help=n.components.help,this.error=n.components.error,this.text=n.components.text,this.text.addEventListener("keydown",this.boundOnKeyDown),this.text.addEventListener("keyup",this.boundOnKeyUp),this.text.addEventListener("blur",this.boundCancel))},o.prototype.onKeyDown=function(t){switch(t.keyCode){case 13:t.ctrlKey&&t.preventDefault();break;case 27:return this.cancel(),void t.preventDefault()}this.resizeTextRows()},o.prototype.onKeyUp=function(t){switch(t.keyCode){case 13:if(Date.now()-this.lastEnter<1e3||t.ctrlKey)return t.preventDefault(),void this.finish();this.lastEnter=Date.now();break;default:this.lastEnter=0}this.resizeTextRows()}}],["turmite/constants.js","hexant/turmite","constants.js",{},function(t,e,n,r,s){"use strict";var o={};o.RelForward=1,o.RelBackward=2,o.RelLeft=4,o.RelRight=8,o.RelDoubleLeft=16,o.RelDoubleRight=32,o.AbsNorthWest=64,o.AbsNorth=128,o.AbsNorthEast=256,o.AbsSouthEast=512,o.AbsSouth=1024,o.AbsSouthWest=2048;var i=[];i[o.RelBackward]=3,i[o.RelDoubleLeft]=-2,i[o.RelLeft]=-1,i[o.RelForward]=0,i[o.RelRight]=1,i[o.RelDoubleRight]=2;var a=[];a[o.AbsSouthEast]=0,a[o.AbsSouth]=1,a[o.AbsSouthWest]=2,a[o.AbsNorthWest]=3,a[o.AbsNorth]=4,a[o.AbsNorthEast]=5;var u=[];u[o.RelBackward]="B",u[o.RelDoubleLeft]="BL",u[o.RelLeft]="L",u[o.RelForward]="F",u[o.RelRight]="R",u[o.RelDoubleRight]="BR";var l={};l.B=o.RelBackward,l.P=o.RelDoubleLeft,l.L=o.RelLeft,l.F=o.RelForward,l.R=o.RelRight,l.S=o.RelDoubleRight;var h={};h.NW=o.AbsNorthWest,h.NO=o.AbsNorth,h.NE=o.AbsNorthEast,h.SE=o.AbsSouthEast,h.SO=o.AbsSouth,h.SW=o.AbsSouthWest,n.exports.Turn=o,n.exports.RelTurnDelta=i,n.exports.AbsTurnDir=a,n.exports.RelTurnSymbols=u,n.exports.RelSymbolTurns=l,n.exports.AbsSymbolTurns=h}],["turmite/index.js","hexant/turmite","index.js",{"../coord.js":10,"./constants.js":22,"./parse.js":32},function(t,e,n,r,s){"use strict";function o(){this.numStates=0,this.numColors=0,this.rules=new Uint32Array(65536),this.specString="",this.dir=0,this.oldDir=0,this.pos=a(0,0,0),this.oldPos=a(0,0,0),this.state=0,this.stateKey=0,this.size=.5,this.index=0}var i=t("../coord.js"),a=i.CubePoint,u=t("./constants.js"),l=t("./parse.js");n.exports=o,o.ruleHelp="ant(<number>?<turn> ...) , turns:\n  - L=left, R=right\n  - B=back, F=forward\n  - P=port, S=starboard (these are rear-facing left/right)\n\nSee README for full turmite language details.",o.prototype.clearRules=function(){for(var t=0;t<this.rules.length;t++)this.rules[t]=0},o.parse=function(t){return l(t)},o.compile=function(t,e){var n=o.parse(t);if(n.err)return n;var r=n.value;return r(e||new o)},o.prototype.toString=function(){return this.specString?this.specString:"<UNKNOWN turmite>"},o.prototype.step=function(t){var e=t.tile,n=e.get(this.pos),r=255&n,s=65280&n,o=this.stateKey|r,i=this.rules[o],u=65535&i,l=(16711680&i)>>16,h=(4278190080&i)>>24;if(s|=256,n=s|l,e.set(this.pos,n),this.oldDir=this.dir,this.oldPos.copyFrom(this.pos),h!==this.state&&(this.state=h,this.stateKey=h<<8),u=this.executeTurn(u),this.pos.add(a.basis[this.dir]),0!==u)throw new Error("turmite forking unimplemented")},o.prototype.executeTurn=function(t){for(var e=1;32>=e;e<<=1)if(t&e)return this.dir=(6+this.oldDir+u.RelTurnDelta[e])%6,t&~e;for(;2048>=e;e<<=1)if(t&e)return this.dir=u.AbsTurnDir[e],t&~e;return 0}}],["turmite/lang/analyze.js","hexant/turmite/lang","analyze.js",{"./walk.js":31},function(t,e,n,r,s){"use strict";function o(t,e){h.iter(t,function(n,r){i(n,t,e),r()})}function i(t,e,n){switch(t.type){case"assign":n[t.id.name]=t.value;break;case"member":"symbol"!==t.value.type&&"identifier"!==t.value.type&&(t.value=a(u(t.value.type,n),t.value,e,n));break;case"turns":n.numColors=Math.max(n.numColors,t.value.length);break;case"then":if("turns"===t.turn.type){var r=h.collect(t.color,l);1===r.length&&(t.turn={type:"member",value:t.turn,item:r[0]})}}}function a(t,e,n,r){return r[t]=e,n.assigns.push({type:"assign",id:{type:"identifier",name:t},value:e}),i(e,n,r),{type:"identifier",name:t}}function u(t,e){for(var n=t[0].toUpperCase()+t.slice(1),r=1;e[n+r];)r++;return n+r}function l(t){return"symbol"===t.type||"identifier"===t.type}var h=t("./walk.js");n.exports=o}],["turmite/lang/build.js","hexant/turmite/lang","build.js",{},function(t,e,n,r,s){"use strict";n.exports.spec=function(t){return{type:"spec",assigns:t[0]||[],rules:t[1]}},n.exports.assign=function(t){return{type:"assign",id:t[0],value:t[4]}},n.exports.rule=function(t){return{type:"rule",when:t[0],then:t[2]}},n.exports.turns=function(t){var e=t[2],n=t[3],r=[e];if(n)for(var s=0;s<n.length;s++)r.push(n[s][1]);return{type:"turns",value:r}},n.exports.turn=function(t){return{type:"turn",names:[t[0]]}},n.exports.multiTurn=function(t){var e=t[0],n=t[2];return{type:"turn",names:e.names.concat(n.names)}},n.exports.singleTurn=function(t){return{count:{type:"number",value:1},turn:t[0]}},n.exports.countTurn=function(t){return{count:t[0],turn:t[1]}},n.exports.when=function(t){return{type:"when",state:t[0],color:t[2]}},n.exports.then=function(t){return{type:"then",state:t[0],color:t[2],turn:t[4]}},n.exports.thenVal=function(t){return{type:"thenVal",mode:t[1],value:t[2]}},n.exports.member=function(t){return{type:"member",value:t[0][0],item:t[2]}},n.exports.expr=function(t){return{type:"expr",op:t[1],arg1:t[0],arg2:t[2]}},n.exports.symbol=function(t){return{type:"symbol",name:t[0]+t[1].join("")}},n.exports.identifier=function(t){return{type:"identifier",name:t[0]+t[1].join("")}},n.exports.rightConcat=function(t){return[t[0]].concat(t[2])},n.exports.noop=function(){return null},n.exports.join=function(t){return t.join("")},n.exports["int"]=function(t){return function(e){var n=e[0].join("");return{type:"number",value:parseInt(n,t)}}},n.exports.item=function(t){return function(e){return e[t]}},n.exports.just=function(t){return function(){return t}}}],["turmite/lang/compile.js","hexant/turmite/lang","compile.js",{"../constants.js":22,"./analyze.js":24,"./tostring.js":30,"./solve.js":29,"./walk.js":31},function(t,e,n,r,s){"use strict";function o(t){var e={_ent:"turmite",numStates:0,numColors:0};S(t,e);var n=["var numStates = "+e.numStates+";","var numColors = "+e.numColors+";"];n=i(t,e,n),n.push("",e._ent+".numStates = numStates;",e._ent+".numColors = numColors;","","return new Result(null, "+e._ent+");");var r=[];return r.push("function init("+e._ent+") {"),x(r,n),r.push("}"),w(["World","Result"],"init",r)}function i(t,e,n){for(var r=0;r<t.assigns.length;r++){var s=t.assigns[r];n=n.concat(b(s,e)),n.push("")}return n=n.concat(a("rules",t.rules,e))}function a(t,e,n){n._state="_state",n._color="_color",n._key="_key",n._result="_res",n._states="_states";var r=[];return r.push("var "+n._states+" = {};","function countState(state) {","    if (!"+n._states+"[state]) {","        "+n._states+"[state] = true;","        numStates++;","    }","}","var "+[n._state,n._color,n._key,n._result].join(", ")+";",n._ent+".clearRules();"),e.forEach(function(t,s){E(t,function(t){s<e.length-1&&(t+="\n"),r.push("",n._ent+".specString += "+JSON.stringify(t)+";")}),r=r.concat(u(t,n))}),r}function u(t,e){return l([],t.when,e,function(n){return d(n,t.then,e,C)})}function l(t,e,n,r){function s(t){return t.push(n._key+" = "+n._state+" << World.ColorShift;"),h({sym:n._color,max:"World.MaxColor",count:null},e.color,t,o,n)}function o(t){return t=r(t)}return h({sym:n._state,max:"World.MaxState",count:"countState"},e.state,t,s,n)}function h(t,e,n,r,s){function o(e){return e.push(t.count+"("+t.sym+");"),r(e)}var i=t.count?o:r;switch(e.type){case"symbol":case"expr":return p(t,e,n,i,s);case"number":return n.push(t.sym+" = "+e.value+";"),i(n);default:throw new Error("unsupported match type "+e.type)}}function p(t,e,n,r,s){n.push("for ("+t.sym+" = 0; "+t.sym+" <= "+t.max+"; "+t.sym+"++) {");var o=c(t,e,[],r,s);return x(n,o),n.push("}"),n}function c(t,e,n,r,s){var o=f(e,s);if(o.length>1)throw new Error("matching more than one variable is unsupported");var i=o[0];if(!i)throw new Error("no match variable");var a=R(i,t.sym,e,s,0);return a===t.sym?(n.push("var "+i+" = "+a+";"),r(n)):(a=t.max+" + "+a+" % "+t.max,n.push("var "+i+" = "+a+";"),n.push("if (Math.floor("+i+") === "+i+") {"),x(n,r([])),n.push("}"),n)}function f(t,e){function n(t,n){"symbol"!==t.type||void 0!==e[t.name]||r[t.name]||(r[t.name]=!0,s.push(t.name)),n()}var r={},s=[];return A.iter(t,n),s}function d(t,e,n,r){var s=t.length,o=m(t,e,n),i=t.length,a=n._ent+".rules["+n._key+" | "+n._color+"]";return o&&t.push(a+" &= ~"+o+";"),i>s&&t.push(a+" |= "+n._result+";"),r(t)}function m(t,e,n){for(var r=["World.MaxState","World.MaxColor","World.MaxTurn"],s=["World.MaskResultState","World.MaskResultColor","World.MaskResultTurn"],o=["World.ColorShift","World.TurnShift"],i=!0,a=[e.state,e.color,e.turn],u=[],l=0;l<a.length;l++){var h=a[l].mode,p=a[l].value;"="===h&&u.push(s[l]);var c=y(p,n);"0"!==c&&("expr"===p.type&&(c="("+c+")"),c+=" & "+r[l],i?(i=!1,t.push(n._result+" = "+c+";")):t.push(n._result+" |= "+c+";")),l<o.length&&!i&&t.push(n._result+" <<= "+o[l]+";")}var f=u.join(" | ");return u.length>1&&(f="("+f+")"),f}function y(t,e,n){switch(n||(n=0),t.type){case"expr":var r=$.indexOf(t.op),s=y(t.arg1,e,r),o=y(t.arg2,e,r),i=s+" "+t.op+" "+o;return n>r?"("+i+")":i;case"member":var a=y(t.value,e,0),u=y(t.item,e,$.length);return u=u+" % "+a+".length",a+"["+u+"]";case"symbol":case"identifier":return t.name;case"turn":return t.names.reduce(function(t,e){return t|j.Turn[e]},0);case"number":return t.value.toString();case"turns":return g(t.value);default:return"/* "+JSON.stringify(t)+" */ undefined"}}function b(t,e){var n=[];return E(t,function(t){t+="\n",n.push("",e._ent+".specString += "+JSON.stringify(t)+";")}),n.push("var "+t.id.name+" = "+y(t.value)+";"),n}function g(t){for(var e=[],n=0;n<t.length;n++)for(var r=t[n],s=j.Turn[r.turn],o="0x"+v(2,s.toString(16)),i=0;i<r.count.value;i++)e.push(o);return"["+e.join(", ")+"]"}function v(t,e){for(;e.length<t;)e="0"+e;return e}function x(t,e){for(var n=0;n<e.length;n++){var r=e[n];r&&(r="    "+r),t.push(r)}return t}function w(t,e,n){var r=t.join(", "),s=[];return s.push("(function("+r+") {"),s=s.concat(n),s.push("","return "+e+";","})("+r+");"),s}function C(t){return t}var j=t("../constants.js"),S=t("./analyze.js"),E=t("./tostring.js"),R=t("./solve.js"),A=t("./walk.js"),$=["+","-","*","/","%"];n.exports.assign=b,n.exports.init=o,n.exports.rule=u,n.exports.rules=a,n.exports.spec=i,n.exports.then=d,n.exports.turns=g,n.exports.value=y,n.exports.when=l,n.exports.whenExprMatch=c,n.exports.whenLoop=p,n.exports.whenMatch=h}],["turmite/lang/grammar.js","hexant/turmite/lang","grammar.js",{"./build.js":25},function(t,e,n,r,s){!function(){function e(t){return t[0]}var r=t("./build.js"),s={ParserRules:[{name:"spec",symbols:["spec$ebnf$1","rules"],postprocess:r.spec},{name:"assigns",symbols:["assign"]},{name:"assigns",symbols:["assign","newline","assigns"],postprocess:r.rightConcat},{name:"assign",symbols:["identifier","_",{literal:"="},"_","lit"],postprocess:r.assign},{name:"rules",symbols:["rule"]},{name:"rules",symbols:["rule","newline","rules"],postprocess:r.rightConcat},{name:"rule$string$1",symbols:[{literal:"="},{literal:">"}],postprocess:function(t){return t.join("")}},{name:"rule",symbols:["when","rule$string$1","then"],postprocess:r.rule},{name:"when",symbols:["expr",{literal:","},"expr"],postprocess:r.when},{name:"then",symbols:["thenState",{literal:","},"thenColor",{literal:","},"thenTurn"],postprocess:r.then},{name:"thenMode",symbols:[],postprocess:r.just("|")},{name:"thenMode",symbols:[{literal:"="}],postprocess:r.item(0)},{name:"thenMode",symbols:[{literal:"|"}],postprocess:r.item(0)},{name:"thenState",symbols:["_","thenMode","sum","_"],postprocess:r.thenVal},{name:"thenColor",symbols:["_","thenMode","sum","_"],postprocess:r.thenVal},{name:"thenTurn",symbols:["_","thenMode","sum","_"],postprocess:r.thenVal},{name:"thenTurn",symbols:["_","thenMode","turnExpr","_"],postprocess:r.thenVal},{name:"turnExpr",symbols:["turn"],postprocess:r.turn},{name:"turnExpr",symbols:["turnExpr",{literal:"|"},"turnExpr"],postprocess:r.multiTurn},{name:"expr",symbols:["_","sum","_"],postprocess:r.item(1)},{name:"sumop",symbols:["_",{literal:"+"},"_"],postprocess:r.item(1)},{name:"sumop",symbols:["_",{literal:"-"},"_"],postprocess:r.item(1)},{name:"mulop",symbols:["_",{literal:"*"},"_"],postprocess:r.item(1)},{name:"mulop",symbols:["_",{literal:"/"},"_"],postprocess:r.item(1)},{name:"mulop",symbols:["_",{literal:"%"},"_"],postprocess:r.item(1)},{name:"sum",symbols:["sum","sumop","mul"],postprocess:r.expr},{name:"sum",symbols:["mul"],postprocess:r.item(0)},{name:"mul",symbols:["mul","mulop","fac"],postprocess:r.expr},{name:"mul",symbols:["fac"],postprocess:r.item(0)},{name:"fac",symbols:[{literal:"("},"expr",{literal:")"}],postprocess:r.item(1)},{name:"fac",symbols:["lit"],postprocess:r.item(0)},{name:"fac",symbols:["member"],postprocess:r.item(0)},{name:"fac",symbols:["symbol"],postprocess:r.item(0)},{name:"fac",symbols:["identifier"],postprocess:r.item(0)},{name:"turns$string$1",symbols:[{literal:"t"},{literal:"u"},{literal:"r"},{literal:"n"},{literal:"s"},{literal:"("}],postprocess:function(t){return t.join("")}},{name:"turns",symbols:["turns$string$1","_","countTurn","turns$ebnf$1","_",{literal:")"}],postprocess:r.turns},{name:"turn",symbols:[{literal:"L"}],postprocess:function(){return"RelLeft"}},{name:"turn",symbols:[{literal:"R"}],postprocess:function(){return"RelRight"}},{name:"turn",symbols:[{literal:"F"}],postprocess:function(){return"RelForward"}},{name:"turn",symbols:[{literal:"B"}],postprocess:function(){return"RelBackward"}},{name:"turn",symbols:[{literal:"P"}],postprocess:function(){return"RelDoubleLeft"}},{name:"turn",symbols:[{literal:"S"}],postprocess:function(){return"RelDoubleRight"}},{name:"turn",symbols:[{literal:"l"}],postprocess:function(){return"RelLeft"}},{name:"turn",symbols:[{literal:"r"}],postprocess:function(){return"RelRight"}},{name:"turn",symbols:[{literal:"f"}],postprocess:function(){return"RelForward"}},{name:"turn",symbols:[{literal:"b"}],postprocess:function(){return"RelBackward"}},{name:"turn",symbols:[{literal:"p"}],postprocess:function(){return"RelDoubleLeft"}},{name:"turn",symbols:[{literal:"s"}],postprocess:function(){return"RelDoubleRight"}},{name:"turn$string$1",symbols:[{literal:"N"},{literal:"W"}],postprocess:function(t){return t.join("")}},{name:"turn",symbols:["turn$string$1"],postprocess:function(){return"AbsNorthWest"}},{name:"turn$string$2",symbols:[{literal:"N"},{literal:"O"}],postprocess:function(t){return t.join("")}},{name:"turn",symbols:["turn$string$2"],postprocess:function(){return"AbsNorth"}},{name:"turn$string$3",symbols:[{literal:"N"},{literal:"E"}],postprocess:function(t){return t.join("")}},{name:"turn",symbols:["turn$string$3"],postprocess:function(){return"AbsNorthEast"}},{name:"turn$string$4",symbols:[{literal:"S"},{literal:"E"}],postprocess:function(t){return t.join("")}},{name:"turn",symbols:["turn$string$4"],postprocess:function(){return"AbsSouthEast"}},{name:"turn$string$5",symbols:[{literal:"S"},{literal:"O"}],postprocess:function(t){return t.join("")}},{name:"turn",symbols:["turn$string$5"],postprocess:function(){return"AbsSouth"}},{name:"turn$string$6",symbols:[{literal:"S"},{literal:"W"}],postprocess:function(t){return t.join("")}},{name:"turn",symbols:["turn$string$6"],postprocess:function(){return"AbsSouthWest"}},{name:"turn$string$7",symbols:[{literal:"n"},{literal:"w"}],postprocess:function(t){return t.join("")}},{name:"turn",symbols:["turn$string$7"],postprocess:function(){return"AbsNorthWest"}},{name:"turn$string$8",symbols:[{literal:"n"},{literal:"o"}],postprocess:function(t){return t.join("")}},{name:"turn",symbols:["turn$string$8"],postprocess:function(){return"AbsNorth"}},{name:"turn$string$9",symbols:[{literal:"n"},{literal:"e"}],postprocess:function(t){return t.join("")}},{name:"turn",symbols:["turn$string$9"],postprocess:function(){return"AbsNorthEast"}},{name:"turn$string$10",symbols:[{literal:"s"},{literal:"e"}],postprocess:function(t){return t.join("")}},{name:"turn",symbols:["turn$string$10"],postprocess:function(){return"AbsSouthEast"}},{name:"turn$string$11",symbols:[{literal:"s"},{literal:"o"}],postprocess:function(t){return t.join("")}},{name:"turn",symbols:["turn$string$11"],postprocess:function(){return"AbsSouth"}},{name:"turn$string$12",symbols:[{literal:"s"},{literal:"w"}],postprocess:function(t){return t.join("")}},{name:"turn",symbols:["turn$string$12"],postprocess:function(){return"AbsSouthWest"}},{name:"countTurn",symbols:["turn"],postprocess:r.singleTurn},{name:"countTurn",symbols:["decint","turn"],postprocess:r.countTurn},{name:"member",symbols:["member$subexpression$1",{literal:"["},"expr",{literal:"]"}],postprocess:r.member},{name:"symbol",symbols:[/[a-z]/,"symbol$ebnf$1"],postprocess:r.symbol},{name:"identifier",symbols:[/[A-Z]/,"identifier$ebnf$1"],postprocess:r.identifier},{name:"lit",symbols:["int"],postprocess:r.item(0)},{name:"lit",symbols:["turns"],postprocess:r.item(0)},{name:"int$string$1",symbols:[{literal:"0"},{literal:"x"}],postprocess:function(t){return t.join("")}},{name:"int",symbols:["int$string$1","hexint"],postprocess:r.item(1)},{name:"int",symbols:["decint"],postprocess:r.item(0)},{name:"hexint",symbols:["hexint$ebnf$1"],postprocess:r["int"](16)},{name:"decint",symbols:["decint$ebnf$1"],postprocess:r["int"](10)},{name:"_",symbols:["_$ebnf$1"],postprocess:r.noop},{name:"__",symbols:["__$ebnf$1"],postprocess:r.noop},{name:"newline",symbols:["newline$ebnf$1",{literal:"\n"}],postprocess:r.noop},{name:"spec$ebnf$1",symbols:["assigns"],postprocess:e},{name:"spec$ebnf$1",symbols:[],postprocess:function(t){return null}},{name:"turns$ebnf$1",symbols:[]},{name:"turns$ebnf$1",symbols:["turns$ebnf$1$subexpression$1","turns$ebnf$1"],postprocess:function(t){return[t[0]].concat(t[1])}},{name:"member$subexpression$1",symbols:["member"]},{name:"member$subexpression$1",symbols:["symbol"]},{name:"member$subexpression$1",symbols:["identifier"]},{name:"member$subexpression$1",symbols:["lit"]},{name:"symbol$ebnf$1",symbols:[]},{name:"symbol$ebnf$1",symbols:[/[\w]/,"symbol$ebnf$1"],postprocess:function(t){return[t[0]].concat(t[1])}},{name:"identifier$ebnf$1",symbols:[/[\w]/]},{name:"identifier$ebnf$1",symbols:[/[\w]/,"identifier$ebnf$1"],postprocess:function(t){return[t[0]].concat(t[1])}},{name:"hexint$ebnf$1",symbols:[/[0-9a-fA-F]/]},{name:"hexint$ebnf$1",symbols:[/[0-9a-fA-F]/,"hexint$ebnf$1"],postprocess:function(t){return[t[0]].concat(t[1])}},{name:"decint$ebnf$1",symbols:[/[0-9]/]},{name:"decint$ebnf$1",symbols:[/[0-9]/,"decint$ebnf$1"],postprocess:function(t){return[t[0]].concat(t[1])}},{name:"_$ebnf$1",symbols:[]},{name:"_$ebnf$1",symbols:[/[\s]/,"_$ebnf$1"],postprocess:function(t){return[t[0]].concat(t[1])}},{name:"__$ebnf$1",symbols:[/[\s]/]},{name:"__$ebnf$1",symbols:[/[\s]/,"__$ebnf$1"],postprocess:function(t){return[t[0]].concat(t[1])}},{name:"newline$ebnf$1",symbols:[{literal:"\r"}],postprocess:e},{name:"newline$ebnf$1",symbols:[],postprocess:function(t){return null}},{name:"turns$ebnf$1$subexpression$1",symbols:["__","countTurn"]}],ParserStart:"spec"};"undefined"!=typeof n&&"undefined"!=typeof n.exports?n.exports=s:window.grammar=s}()}],["turmite/lang/parse.js","hexant/turmite/lang","parse.js",{nearley:38,rezult:41,"./grammar.js":27,"./compile.js":26},function(require,exports,module,__filename,__dirname){"use strict";function parseTurmite(t,e){var n=parseLang(t,e);return n.err||(n=compileGrammarResult(n.value,e)),n}function parseLang(t,e){if("string"!=typeof t)return new Result(new Error("invalid argument, not a string"),null);var n=parseResult(grammar,t);return n.err?n:n.value.length?n.value.length>1?new Result(new Error("ambiguous parse"),null):new Result(null,n.value[0]||null):new Result(new Error("no parse result"),null)}function parseResult(t,e){var n=new nearley.Parser(t.ParserRules,t.ParserStart);try{return n.feed(e),new Result(null,n.results)}catch(r){return new Result(r,null)}}function compileGrammarResult(value,World){var str=compile.init(value).join("\n"),func=eval(str);return new Result(null,func)}var nearley=require("nearley"),Result=require("rezult"),grammar=require("./grammar.js"),compile=require("./compile.js");module.exports=parseTurmite}],["turmite/lang/solve.js","hexant/turmite/lang","solve.js",{"./compile.js":26,"./walk.js":31},function(t,e,n,r,s){"use strict";function o(t,e,n,r,s){switch(n.type){case"expr":var u=i(n.arg1,t),p=i(n.arg2,t);if(!u&&!p)return a.value(n,r,s);if(u&&p)throw new Error("matching complex expressions not supported");if(!h[n.op])throw new Error("unsupported match operator "+n.op);var c=l.indexOf(n.op),f=o(t,e,n.arg1,r,c),d=o(t,e,n.arg2,r,c),m="";if("+"===n.op||"*"===n.op){if(p){var y=f;f=d,d=y}m+=f+" "+h[n.op]+" "+d}return("-"===n.op||"/"===n.op)&&(u?m+=f+" "+h[n.op]+" "+d:p&&(m+=d+" "+n.op+" "+f),m+=f+" "+h[n.op]+" "+d),s>c&&(m="("+m+")"),m;case"symbol":return n.name===t?e:n.name;default:return a.value(n,r)}}function i(t,e){var n=!1;return u.iter(t,function(t,r){"symbol"===t.type&&t.name===e?n=!0:r()}),n}var a=t("./compile.js"),u=t("./walk.js");n.exports=o;var l=["+","-","*","/","%"],h={"+":"-","*":"/","-":"+","/":"*"}}],["turmite/lang/tostring.js","hexant/turmite/lang","tostring.js",{"../rle-builder.js":33,"./walk.js":31},function(t,e,n,r,s){"use strict";function o(t,e){function n(t,n){switch(t.type){case"spec":n();break;case"assign":h.push(t.id.name),n(),r(" = "),e(h.pop());break;case"rule":n(),r(" => "),e(h.pop());break;case"when":n(),r(", ");break;case"then":n(),r(", "),r(", ");break;case"thenVal":"|"===t.mode?n():(h.push(t.mode),n(),r(""));break;case"member":n(),s("[","]"),r("");break;case"expr":o.push(l.indexOf(t.op)),n(),r(" "+t.op+" "),o.pop()<o[o.length-1]&&s("(",")");break;case"identifier":case"symbol":h.push(t.name),n();break;case"turns":for(var a=i("turns("," ",")"),p=0;p<t.value.length;p++){var c=t.value[p];a(c.count.value,u[c.turn])}h.push(a(0,"")),n();break;case"turn":h.push(t.names.map(function(t){return u[t]}).join("|"));break;case"number":h.push(t.value.toString()),n();break;default:h.push("/* unsupported "+JSON.stringify(t)+" */"),n()}}function r(t){var e=h.pop(),n=h.pop(),r=n+t+e;h.push(r)}function s(t,e){var n=h.length-1;h[n]=t+h[n]+e}var o=[0],h=[];if(a.iter(t,n),h.length)throw new Error("leftover spec string parts")}var i=t("../rle-builder.js"),a=t("./walk.js");n.exports=o;var u={RelLeft:"L",RelRight:"R",RelForward:"F",RelBackward:"B",RelDoubleLeft:"P",RelDoubleRight:"S",AbsNorth:"NO",AbsNorthWest:"NW",AbsNorthEast:"NE",AbsSouth:"SO",AbsSouthEast:"SE",AbsSouthWest:"SW"},l=["+","-","*","/","%"]}],["turmite/lang/walk.js","hexant/turmite/lang","walk.js",{},function(t,e,n,r,s){"use strict";function o(t,e){function n(t){function n(){r(t)}e(t,n)}function r(t){switch(t.type){case"spec":var e;for(e=0;e<t.assigns.length;e++)n(t.assigns[e]);for(e=0;e<t.rules.length;e++)n(t.rules[e]);break;case"assign":n(t.value);break;case"rule":n(t.when),n(t.then);break;case"when":n(t.state),n(t.color);break;case"then":n(t.state),n(t.color),n(t.turn);break;case"thenVal":n(t.value);break;case"member":n(t.value),n(t.item);break;case"expr":n(t.arg1),n(t.arg2);break;case"identifier":case"number":case"symbol":case"turn":case"turns":break;default:throw new Error("unimplemnted walk type "+t.type)}}n(t)}function i(t,e){var n=[];return o(t,function(t,r){e(t)&&n.push(t),r()}),n}n.exports.iter=o,n.exports.collect=i}],["turmite/parse.js","hexant/turmite","parse.js",{rezult:41,"../world.js":35,"./rle-builder.js":33,"./constants.js":22,"./lang/parse.js":28},function(t,e,n,r,s){"use strict";function o(t){for(var e=[a,f],n=0;n<e.length;n++){var r=e[n](t,h);if(r.err||r.value)return r}return new l(new Error("invalid spec string"),null)}function i(t){t=t.toUpperCase();for(var e=[],n=0;n<t.length;n++){var r=y[t[n]];if(void 0===r)return void 0;e.push(r)}return"ant("+e.join(" ")+")"}function a(t){function e(t){return u(s,t)}var n=d.exec(t);if(n&&(t=i(n[1])),n=m.exec(t),!n)return new l(null,null);t=n[1];var r=0,s=[],o=/\s*\b(\d+)?(?:(B|P|L|F|R|S)|(NW|NO|NE|SE|SO|SW))\b\s*/g;t=t.toUpperCase();var a=0;for(n=o.exec(t);n&&a===n.index;a+=n[0].length,n=o.exec(t)){var p={mult:0,turn:0,sym:""};if(p.mult=n[1]?parseInt(n[1],10):1,n[2]?(p.sym=n[2],p.turn=c.RelSymbolTurns[n[2]]):n[3]&&(p.sym=n[3],p.turn=c.AbsSymbolTurns[n[3]]),r+=p.mult,r>h.MaxColor)return new l(new Error("too many colors needed for ant ruleset"),null);s.push(p)}return new l(null,e)}function u(t,e){for(var n=0,r=p("ant("," ",")"),s=[],o=0;o<t.length;o++){for(var i=t[o].mult,a=0;i>a;a++)s.push(t[o].turn);n+=t[o].mult,r(t[o].mult,t[o].sym)}e.clearRules();for(var u=0;u<=h.MaxColor;u++){var c=s[u%s.length],f=u+1&h.MaxColor;e.rules[u]=f<<h.TurnShift|c}return e.state=0,e.specString=r(0,""),e.numColors=n,e.numStates=1,new l(null,e)}n.exports=o;var l=t("rezult"),h=t("../world.js"),p=t("./rle-builder.js"),c=t("./constants.js"),f=t("./lang/parse.js"),d=/^\s*([lrwefaLRWEFA]+)\s*$/,m=/^\s*ant\(\s*(.+?)\s*\)\s*$/,y={L:"L",R:"R",W:"P",E:"S",F:"B",A:"F"}}],["turmite/rle-builder.js","hexant/turmite","rle-builder.js",{},function(t,e,n,r,s){"use strict";function o(t,e,n){function r(t,e){if(r.cur!==e&&(r.cur&&r.count&&(r.init?r.init=!1:r.str+=r.sep,r.count>1&&(r.str+=r.count.toString()),r.str+=r.cur),r.cur=e||"",r.count=0),0===t&&!e){var n=r.str+r.suffix;return r.cur="",r.count=0,r.str=r.prefix,r.init=!1,n}return r.count+=t,""}return r.prefix=t,r.sep=e,r.suffix=n,r.cur="",r.count=0,r.str=r.prefix,r.init=!0,r}n.exports=o}],["view.js","hexant","view.js",{"./hexgrid.js":13,"./ngoncontext.js":19,"./world.js":35},function(t,e,n,r,s){"use strict";function o(t,e){return this instanceof o?(this.world=t,this.canvas=e,this.ctx2d=this.canvas.getContext("2d"),this.ctxHex=new u(6,this.ctx2d),this.labeled=!1,this.drawUnvisited=!1,this.drawTrace=!1,this.antCellColorGen=null,this.emptyCellColorGen=null,this.bodyColorGen=null,this.headColorGen=null,this.antCellColors=[],this.emptyCellColors=[],this.bodyColors=[],this.headColors=[],this.lastEntPos=[],this.hexGrid=new a(this.canvas,this.ctxHex,this.world.tile.boundingBox().copy()),void(this.needsRedraw=!1)):new o(t,e)}function i(t,e){var n=e,r=t[e];for(n=e++;e<t.length;e++,n++)t[n]=t[e];return t[n]=r,n}var a=t("./hexgrid.js"),u=t("./ngoncontext.js"),l=t("./world.js");n.exports=o,o.prototype.resize=function(t,e){this.hexGrid.resize(t,e),this.redraw()},o.prototype.redraw=function(){var t=this,e=t.world.ents,n=this.drawTrace?this.emptyCellColors:this.antCellColors;t.world.tile.eachDataPoint(this.drawUnvisited?function(e,r){t.drawCell(e,r&l.MaskColor,n)}:function(e,r){r&l.FlagVisited&&t.drawCell(e,r&l.MaskColor,n)});for(var r=0;r<e.length;r++)for(t.drawEnt(e[r]),r=0;r<e.length;r++)this.lastEntPos[r].copyFrom(e[r].pos)},o.prototype.updateEnts=function(){var t;for(t=0;t<this.world.ents.length;t++){var e=this.world.ents[t];t<this.lastEntPos.length?this.lastEntPos[t].copyFrom(e.pos):this.lastEntPos.push(e.pos.copy())}for(;t<this.lastEntPos.length;)this.lastEntPos.pop();this.updateColors(!1)},o.prototype.addEnt=function(t){this.lastEntPos.push(t.pos.copy()),this.updateColors(!1)},o.prototype.updateEnt=function(t){this.lastEntPos[t.index].copyFrom(t.pos),this.updateColors(!1)},o.prototype.removeEnt=function(t){i(this.lastEntPos,t.index),this.lastEntPos.pop(),this.updateColors(!1)},o.prototype.setColorGen=function(t){this.emptyCellColorGen=t(0),this.antCellColorGen=t(1),this.bodyColorGen=t(2),this.headColorGen=t(3),this.updateColors(!0)},o.prototype.updateColors=function(t){var e=this.world.numColors,n=this.world.ents.length;if(this.emptyCellColorGen&&(t||this.emptyCellColors.length!==e))for(this.emptyCellColors=this.emptyCellColorGen(e);this.emptyCellColors.length<=l.MaxColor;)this.emptyCellColors.push(this.emptyCellColors[this.emptyCellColors.length%e]);if(this.antCellColorGen&&(t||this.antCellColors.length!==e))for(this.antCellColors=this.antCellColorGen(e);this.antCellColors.length<=l.MaxColor;)this.antCellColors.push(this.antCellColors[this.antCellColors.length%e]);this.bodyColorGen&&(t||this.bodyColors.length!==n)&&(this.bodyColors=this.bodyColorGen(n)),this.headColorGen&&(t||this.headColors.length!==n)&&(this.headColors=this.headColorGen(n))},o.prototype.setLabeled=function(t){this.labeled=t,this.labeled?this.drawCell=this.drawLabeledCell:this.drawCell=this.drawUnlabeledCell},o.prototype.drawUnlabeledCell=function(t,e,n){this.ctx2d.beginPath();var r=this.hexGrid.cellPath(t);return this.ctx2d.closePath(),this.ctx2d.fillStyle=n[e],this.ctx2d.fill(),r},o.prototype.drawLabeledCell=function(t,e,n){var r=this.drawUnlabeledCell(t,e,n);this.drawCellLabel(t,r)},o.prototype.drawCellLabel=function(t,e){function n(t,n){var s=r.measureText(t).width;r.strokeText(t,e.x-s/2,e.y+n)}e||(e=this.hexGrid.toScreen(t));var r=this.ctx2d;r.lineWidth=1,r.strokeStyle="#fff",n(t.toCube().toString(),0),n(t.toOddQOffset().toString(),14)},o.prototype.drawCell=o.prototype.drawUnlabeledCell,o.prototype.step=function(){var t,e=this.world.ents,n=!1;for(t=0;t<e.length;t++)n=this.hexGrid.bounds.expandTo(e[t].pos)||n;if(n&&(this.needsRedraw=!0,this.hexGrid.updateSize()),!this.needsRedraw){for(t=0;t<e.length;t++){var r=this.world.tile.get(this.lastEntPos[t]);this.drawCell(this.lastEntPos[t],r&l.MaskColor,this.antCellColors)}for(t=0;t<e.length;t++)this.drawEnt(e[t]),this.lastEntPos[t].copyFrom(e[t].pos)}},o.prototype.drawEnt=function(t){var e=this.world.tile.get(t.pos);e&l.FlagVisited||(e=this.world.tile.set(t.pos,e|l.FlagVisited),this.drawCell(t.pos,e&l.MaskColor,this.antCellColors));var n=this.hexGrid.toScreen(t.pos),r=this.hexGrid.cellSize*t.size;5>=r?this.drawSmallEnt(t,n,r):this.drawFullEnt(t,n,r),this.labeled&&this.drawCellLabel(t.pos,n)},o.prototype.drawFullEnt=function(t,e,n){var r=this.hexGrid.ctxHex,s=r.ctx2d,o=t.dir,i=t.dir+1;s.fillStyle=this.headColors[t.index],s.strokeStyle=this.headColors[t.index],s.lineWidth=n/2,s.beginPath(),r.wedge(e.x,e.y,n,o,i,!1),s.closePath(),s.fill(),s.stroke(),s.fillStyle=this.bodyColors[t.index],s.beginPath(),r.wedge(e.x,e.y,n,o,i,!0),s.closePath(),s.fill()},o.prototype.drawSmallEnt=function(t,e,n){var r=this.hexGrid.ctxHex,s=r.ctx2d;s.fillStyle=this.headColors[t.index],s.beginPath(),r.full(e.x,e.y,n),s.closePath(),s.fill()}}],["world.js","hexant","world.js",{
"./coord.js":10,"./hextiletree.js":15},function(t,e,n,r,s){"use strict";function o(){this.numColors=0,this.numStates=0,this.tile=new a(u(0,0),2,2),this.ents=[],this.views=[]}var i=t("./coord.js"),a=t("./hextiletree.js"),u=i.OddQOffset;n.exports=o,o.StateShift=8,o.ColorShift=8,o.TurnShift=16,o.FlagVisited=256,o.MaskFlags=65280,o.MaskColor=255,o.MaxState=255,o.MaxColor=255,o.MaxTurn=65535,o.MaskResultState=4278190080,o.MaskResultColor=16711680,o.MaskResultTurn=65535,o.prototype.step=function(){var t;for(t=0;t<this.ents.length;t++)this.ents[t].step(this);for(t=0;t<this.views.length;t++){var e=this.views[t];e.step(),e.needsRedraw&&(e.redraw(),e.needsRedraw=!1)}},o.prototype.stepn=function(t){var e,n;for(e=0;t>e;e++){for(n=0;n<this.ents.length;n++)this.ents[n].step(this);for(n=0;n<this.views.length;n++)this.views[n].step()}var r=!1;for(e=0;e<this.views.length;e++){var s=this.views[e];s.needsRedraw&&(s.redraw(),s.needsRedraw=!1,r=!0)}return r},o.prototype.addEnt=function(t){this.numColors=Math.max(this.numColors,t.numColors),this.numStates=Math.max(this.numStates,t.numStates),t.index=this.ents.length,this.ents.push(t);var e=this.tile.get(t.pos);e&o.FlagVisited||(e=this.tile.set(t.pos,e|o.FlagVisited));for(var n=0;n<this.views.length;n++)this.views[n].addEnt(t);return t},o.prototype.updateEnt=function(t,e){for(void 0===e?e=t.index:t.index=e,this.ents[e]!==t&&(this.ents[e]=t),this.numColors=0,this.numStates=0,e=0;e<this.ents.length;e++)this.numColors=Math.max(this.numColors,this.ents[e].numColors),this.numStates=Math.max(this.numStates,this.ents[e].numStates);for(e=0;e<this.views.length;e++)this.views[e].updateEnt(t);return t},o.prototype.removeEnt=function(t){if(this.ents[t.index]!==t)throw new Error("removeEnt mismatch");for(var e=t.index,n=e++;e<this.ents.length;e++,n++)this.ents[n]=this.ents[e],this.ents[n].index=n;for(this.ents.pop(),e=0;e<this.views.length;e++)this.views[e].removeEnt(t);return t},o.prototype.addView=function(t){return this.views.push(t),t.updateEnts(),t}}],["husl.js","husl","husl.js",{},function(t,e,n,r,s){(function(){var t,e,r,s,o,i,a,u,l,h,p,c,f,d,m,y,b,g,v;c={R:[3.2409699419045213,-1.5373831775700935,-.4986107602930033],G:[-.9692436362808798,1.8759675015077206,.04155505740717561],B:[.05563007969699361,-.20397695888897657,1.0569715142428786]},f={X:[.4123907992659595,.35758433938387796,.1804807884018343],Y:[.21263900587151036,.7151686787677559,.07219231536073371],Z:[.01933081871559185,.11919477979462599,.9505321522496606]},y=.19783000664283681,b=.468319994938791,h=903.2962962962963,i=.008856451679035631,u=function(t){var e,n,r,s,o,a,u,l,p,f,d,m,y,b,g,v,x,w;for(b=Math.pow(t+16,3)/1560896,g=b>i?b:t/h,y=[],f=["R","G","B"],r=0,o=f.length;o>r;r++)for(n=f[r],d=c[n],u=d[0],l=d[1],p=d[2],m=[0,1],s=0,a=m.length;a>s;s++)v=m[s],x=(284517*u-94839*p)*g,w=(838422*p+769860*l+731718*u)*t*g-769860*v*t,e=(632260*p-126452*l)*g+126452*v,y.push([x/e,w/e]);return y},l=function(t,e){return(t[1]-e[1])/(e[0]-t[0])},s=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2))},p=function(t,e){var n,r,s;return s=e[0],n=e[1],r=n/(Math.sin(t)-s*Math.cos(t)),0>r?null:r},m=function(t){var e,n,r,o,i,a,h,p;for(o=[],a=u(t),n=0,r=a.length;r>n;n++)h=a[n],i=h[0],e=h[1],p=l([i,e],[-1/i,0]),o.push(s([p,e+p*i]));return Math.min.apply(Math,o)},d=function(t,e){var n,r,s,o,i,a,l;for(n=e/360*Math.PI*2,i=[],l=u(t),r=0,o=l.length;o>r;r++)a=l[r],s=p(n,a),null!==s&&i.push(s);return Math.min.apply(Math,i)},o=function(t,e){var n,r,s,o;for(o=0,n=r=0,s=t.length-1;s>=0?s>=r:r>=s;n=s>=0?++r:--r)o+=t[n]*e[n];return o},a=function(t){return.0031308>=t?12.92*t:1.055*Math.pow(t,1/2.4)-.055},v=function(t){var e;return e=.055,t>.04045?Math.pow((t+e)/(1+e),2.4):t/12.92},r={xyz:{},luv:{},lch:{},husl:{},huslp:{},rgb:{},hex:{}},r.xyz.rgb=function(t){var e,n,r;return r=a(o(c.R,t)),n=a(o(c.G,t)),e=a(o(c.B,t)),[r,n,e]},r.rgb.xyz=function(t){var e,n,r,s,i,a,u;return r=t[0],n=t[1],e=t[2],u=[v(r),v(n),v(e)],s=o(f.X,u),i=o(f.Y,u),a=o(f.Z,u),[s,i,a]},e=function(t){return i>=t?t*h:116*Math.pow(t,1/3)-16},t=function(t){return 8>=t?t/h:Math.pow((t+16)/116,3)},r.xyz.luv=function(t){var n,r,s,o,i,a,u,l;return o=t[0],i=t[1],a=t[2],0===i?[0,0,0]:(n=e(i),u=4*o/(o+15*i+3*a),l=9*i/(o+15*i+3*a),r=13*n*(u-y),s=13*n*(l-b),[n,r,s])},r.luv.xyz=function(e){var n,r,s,o,i,a,u,l;return n=e[0],r=e[1],s=e[2],0===n?[0,0,0]:(u=r/(13*n)+y,l=s/(13*n)+b,i=t(n),o=0-9*i*u/((u-4)*l-u*l),a=(9*i-15*l*i-l*o)/(3*l),[o,i,a])},r.luv.lch=function(t){var e,n,r,s,o,i;return s=t[0],o=t[1],i=t[2],e=Math.sqrt(Math.pow(o,2)+Math.pow(i,2)),1e-8>e?n=0:(r=Math.atan2(i,o),n=360*r/2/Math.PI,0>n&&(n=360+n)),[s,e,n]},r.lch.luv=function(t){var e,n,r,s,o,i;return s=t[0],e=t[1],n=t[2],r=n/360*2*Math.PI,o=Math.cos(r)*e,i=Math.sin(r)*e,[s,o,i]},r.husl.lch=function(t){var e,n,r,s,o;return n=t[0],s=t[1],r=t[2],r>99.9999999||1e-8>r?e=0:(o=d(r,n),e=o/100*s),[r,e,n]},r.lch.husl=function(t){var e,n,r,s,o;return r=t[0],e=t[1],n=t[2],r>99.9999999||1e-8>r?s=0:(o=d(r,n),s=e/o*100),[n,s,r]},r.huslp.lch=function(t){var e,n,r,s,o;return n=t[0],s=t[1],r=t[2],r>99.9999999||1e-8>r?e=0:(o=m(r),e=o/100*s),[r,e,n]},r.lch.huslp=function(t){var e,n,r,s,o;return r=t[0],e=t[1],n=t[2],r>99.9999999||1e-8>r?s=0:(o=m(r),s=e/o*100),[n,s,r]},r.rgb.hex=function(t){var e,n,r,s;for(n="#",r=0,s=t.length;s>r;r++){if(e=t[r],e=Math.round(1e6*e)/1e6,0>e||e>1)throw new Error("Illegal rgb value: "+e);e=Math.round(255*e).toString(16),1===e.length&&(e="0"+e),n+=e}return n},r.hex.rgb=function(t){var e,n,r,s,o,i,a,u;for("#"===t.charAt(0)&&(t=t.substring(1,7)),i=t.substring(0,2),n=t.substring(2,4),e=t.substring(4,6),a=[i,n,e],u=[],r=0,s=a.length;s>r;r++)o=a[r],u.push(parseInt(o,16)/255);return u},r.lch.rgb=function(t){return r.xyz.rgb(r.luv.xyz(r.lch.luv(t)))},r.rgb.lch=function(t){return r.luv.lch(r.xyz.luv(r.rgb.xyz(t)))},r.husl.rgb=function(t){return r.lch.rgb(r.husl.lch(t))},r.rgb.husl=function(t){return r.lch.husl(r.rgb.lch(t))},r.huslp.rgb=function(t){return r.lch.rgb(r.huslp.lch(t))},r.rgb.huslp=function(t){return r.lch.huslp(r.rgb.lch(t))},g={},g.fromRGB=function(t,e,n){return r.rgb.husl([t,e,n])},g.fromHex=function(t){return r.rgb.husl(r.hex.rgb(t))},g.toRGB=function(t,e,n){return r.husl.rgb([t,e,n])},g.toHex=function(t,e,n){return r.rgb.hex(r.husl.rgb([t,e,n]))},g.p={},g.p.toRGB=function(t,e,n){return r.xyz.rgb(r.luv.xyz(r.lch.luv(r.huslp.lch([t,e,n]))))},g.p.toHex=function(t,e,n){return r.rgb.hex(r.xyz.rgb(r.luv.xyz(r.lch.luv(r.huslp.lch([t,e,n])))))},g.p.fromRGB=function(t,e,n){return r.lch.huslp(r.luv.lch(r.xyz.luv(r.rgb.xyz([t,e,n]))))},g.p.fromHex=function(t){return r.lch.huslp(r.luv.lch(r.xyz.luv(r.rgb.xyz(r.hex.rgb(t)))))},g._conv=r,g._getBounds=u,g._maxChromaForLH=d,g._maxSafeChromaForL=m,"undefined"!=typeof n&&null!==n||"undefined"!=typeof jQuery&&null!==jQuery||"undefined"!=typeof requirejs&&null!==requirejs||(this.HUSL=g),"undefined"!=typeof n&&null!==n&&(n.exports=g),"undefined"!=typeof jQuery&&null!==jQuery&&(jQuery.husl=g),"undefined"!=typeof requirejs&&null!==requirejs&&"undefined"!=typeof define&&null!==define&&define(g)}).call(this)}],["koerper.js","koerper","koerper.js",{wizdom:42},function(t,e,n,r,s){"use strict";function o(t){i.call(this,this),this.actualNode=t,this.actualDocument=t.ownerDocument,this.documentElement=this.createBody(),this.documentElement.parentNode=this,t.appendChild(this.documentElement.actualNode),this.firstChild=this.documentElement,this.lastChild=this.documentElement}function i(t){c.call(this,t),this.actualNode=null}function a(t,e,n){c.call(this,t,n),n?this.actualNode=t.actualDocument.createElementNS(n,e):this.actualNode=t.actualDocument.createElement(e),this.attributes=this.actualNode.attributes}function u(t,e){i.call(this,t),this.actualNode=t.actualDocument.createTextNode(e)}function l(t,e){i.call(this,t),this.actualNode=t.actualDocument.createTextNode(""),this.actualFirstChild=null,this.actualBody=t.actualDocument.createElement("BODY")}function h(t,e){i.call(this,t),this.actualFirstChild=e.firstChild}var p=t("wizdom"),c=p.prototype.Node;p.prototype.Element,p.prototype.TextNode;n.exports=o,o.prototype=Object.create(p.prototype),o.prototype.Node=i,o.prototype.Element=a,o.prototype.TextNode=u,o.prototype.Body=l,o.prototype.OpaqueHtml=h,o.prototype.createBody=function(t){return new this.Body(this,t)},o.prototype.getActualParent=function(){return this.actualNode},i.prototype=Object.create(c.prototype),i.prototype.constructor=i,i.prototype.insertBefore=function(t,e){if(e&&e.parentNode!==this)throw new Error("Can't insert before node that is not a child of parent");c.prototype.insertBefore.call(this,t,e);var n,r=this.getActualParent();return e&&(n=e.getActualFirstChild()),n||(n=this.getActualNextSibling()),n&&n.parentNode!==r&&(n=null),r.insertBefore(t.actualNode,n||null),t.inject(),t},i.prototype.removeChild=function(t){if(!t)throw new Error("Can't remove child "+t);t.extract(),this.getActualParent().removeChild(t.actualNode),c.prototype.removeChild.call(this,t)},i.prototype.setAttribute=function(t,e){this.actualNode.setAttribute(t,e)},i.prototype.getAttribute=function(t){this.actualNode.getAttribute(t)},i.prototype.hasAttribute=function(t){this.actualNode.hasAttribute(t)},i.prototype.removeAttribute=function(t){this.actualNode.removeAttribute(t)},i.prototype.addEventListener=function(t,e,n){this.actualNode.addEventListener(t,e,n)},i.prototype.removeEventListener=function(t,e,n){this.actualNode.removeEventListener(t,e,n)},i.prototype.inject=function(){},i.prototype.extract=function(){},i.prototype.getActualParent=function(){return this.actualNode},i.prototype.getActualFirstChild=function(){return this.actualNode},i.prototype.getActualNextSibling=function(){return null},Object.defineProperty(i.prototype,"innerHTML",{get:function(){return this.actualNode.innerHTML}}),a.prototype=Object.create(i.prototype),a.prototype.constructor=a,a.prototype.nodeType=1,u.prototype=Object.create(i.prototype),u.prototype.constructor=u,u.prototype.nodeType=3,Object.defineProperty(u.prototype,"data",{set:function(t){this.actualNode.data=t},get:function(){return this.actualNode.data}}),l.prototype=Object.create(i.prototype),l.prototype.constructor=l,l.prototype.nodeType=13,l.prototype.extract=function(){for(var t,e=this.actualBody,n=this.actualNode,r=this.parentNode.getActualParent(),s=this.getActualFirstChild();s&&s!==n;)t=s.nextSibling,e?e.appendChild(s):r.removeChild(s),s=t},l.prototype.inject=function(){if(!this.parentNode)throw new Error("Can't inject without a parent node");for(var t,e=this.actualBody,n=this.actualNode,r=this.parentNode.getActualParent(),s=e.firstChild;s;)t=s.nextSibling,r.insertBefore(s,n),s=t},l.prototype.getActualParent=function(){return this.parentNode?this.parentNode.getActualParent():this.actualBody},l.prototype.getActualFirstChild=function(){return this.firstChild?this.firstChild.getActualFirstChild():this.actualNode},l.prototype.getActualNextSibling=function(){return this.actualNode},Object.defineProperty(l.prototype,"innerHTML",{get:function(){if(this.parentNode){this.extract();var t=this.actualBody.innerHTML;return this.inject(),t}return this.actualBody.innerHTML},set:function(t){return this.parentNode?(this.extract(),this.actualBody.innerHTML=t,this.firstChild=this.lastChild=new h(this.ownerDocument,this.actualBody),this.inject()):(this.actualBody.innerHTML=t,this.firstChild=this.lastChild=new h(this.ownerDocument,this.actualBody)),t}}),h.prototype=Object.create(i.prototype),h.prototype.constructor=h,h.prototype.getActualFirstChild=function(){return this.actualFirstChild}}],["lib/nearley.js","nearley/lib","nearley.js",{},function(t,e,n,r,s){!function(){function t(t,e,n){return this.name=t,this.symbols=e,this.postprocess=n,this}function e(t,e,n){this.rule=t,this.expect=e,this.reference=n,this.data=[]}function r(n,r){var s=this.table=[];this.rules=n.map(function(e){return new t(e.name,e.symbols,e.postprocess)}),this.start=r=r||this.rules[0].name;var o=[];this.table.push([]),this.rules.forEach(function(t){t.name===r&&(o.push(t),s[0].push(new e(t,0,0)))}),this.advanceTo(0,o),this.current=0}t.prototype.toString=function(t){function e(t){return t.literal?JSON.stringify(t.literal):t.toString()}var n="undefined"==typeof t?this.symbols.map(e).join(" "):this.symbols.slice(0,t).map(e).join(" ")+" ● "+this.symbols.slice(t).map(e).join(" ");return this.name+" → "+n},e.prototype.toString=function(){return"{"+this.rule.toString(this.expect)+"}, from: "+(this.reference||0)},e.prototype.nextState=function(t){var n=new e(this.rule,this.expect+1,this.reference);return n.data=this.data.slice(0),n.data.push(t),n},e.prototype.consumeTerminal=function(t){var e=!1;return this.rule.symbols[this.expect]&&(this.rule.symbols[this.expect].test?this.rule.symbols[this.expect].test(t)&&(e=this.nextState(t)):this.rule.symbols[this.expect].literal===t&&(e=this.nextState(t))),e},e.prototype.consumeNonTerminal=function(t){return this.rule.symbols[this.expect]===t?this.nextState(t):!1},e.prototype.process=function(t,n,s,o){if(this.expect===this.rule.symbols.length){if(this.rule.postprocess&&(this.data=this.rule.postprocess(this.data,this.reference,r.fail)),this.data!==r.fail)for(var i,a,u=0;u<n[this.reference].length;)i=n[this.reference][u],a=i.consumeNonTerminal(this.rule.name),a&&(a.data[a.data.length-1]=this.data,n[t].push(a)),u++}else{for(var l=n[t].indexOf(this),h=0;l>h;h++){var p=n[t][h];if(p.rule.symbols.length===p.expect&&p.reference===t){var a=this.consumeNonTerminal(p.rule.name);a&&(a.data[a.data.length-1]=p.data,n[t].push(a))}}var c=this.rule.symbols[this.expect],f=this;s.forEach(function(r){if(r.name===c&&-1===o.indexOf(r))if(r.symbols.length>0)o.push(r),n[t].push(new e(r,0,t));else{var s=f.consumeNonTerminal(r.name);r.postprocess?s.data[s.data.length-1]=r.postprocess([],this.reference):s.data[s.data.length-1]=[],n[t].push(s)}})}},r.fail={},r.prototype.advanceTo=function(t,e){for(var n=0;n<this.table[t].length;)this.table[t][n].process(t,this.table,this.rules,e),n++},r.prototype.feed=function(t){for(var e=0;e<t.length;e++){this.table.push([]);for(var n=0;n<this.table[this.current+e].length;n++){var r=this.table[this.current+e][n],s=r.consumeTerminal(t[e]);s&&this.table[this.current+e+1].push(s)}var o=[];if(this.advanceTo(this.current+e+1,o),0===this.table[this.table.length-1].length){var i=new Error("nearley: No possible parsings (@"+(this.current+e)+": '"+t[e]+"').");throw i.offset=this.current+e,i}}return this.current+=e,this.results=this.finish(),this},r.prototype.finish=function(){var t=[],e=this;return this.table[this.table.length-1].forEach(function(n){n.rule.name===e.start&&n.expect===n.rule.symbols.length&&0===n.reference&&n.data!==r.fail&&t.push(n)}),t.map(function(t){return t.data})};var s={Parser:r,Rule:t};"undefined"!=typeof n&&"undefined"!=typeof n.exports?n.exports=s:window.nearley=s}()}],["lib/performance-now.js","performance-now/lib","performance-now.js",{},function(t,e,n,r,s){(function(){var t,e,r;"undefined"!=typeof performance&&null!==performance&&performance.now?n.exports=function(){return performance.now()}:"undefined"!=typeof process&&null!==process&&process.hrtime?(n.exports=function(){return(t()-r)/1e6},e=process.hrtime,t=function(){var t;return t=e(),1e9*t[0]+t[1]},r=t()):Date.now?(n.exports=function(){return Date.now()-r},r=Date.now()):(n.exports=function(){return(new Date).getTime()-r},r=(new Date).getTime())}).call(this)}],["index.js","raf","index.js",{"performance-now":39},function(t,e,n,r,s){for(var o=t("performance-now"),i="undefined"==typeof window?{}:window,a=["moz","webkit"],u="AnimationFrame",l=i["request"+u],h=i["cancel"+u]||i["cancelRequest"+u],p=!0,c=0;c<a.length&&!l;c++)l=i[a[c]+"Request"+u],h=i[a[c]+"Cancel"+u]||i[a[c]+"CancelRequest"+u];if(!l||!h){p=!1;var f=0,d=0,m=[],y=1e3/60;l=function(t){if(0===m.length){var e=o(),n=Math.max(0,y-(e-f));f=n+e,setTimeout(function(){var t=m.slice(0);m.length=0;for(var e=0;e<t.length;e++)if(!t[e].cancelled)try{t[e].callback(f)}catch(n){setTimeout(function(){throw n},0)}},Math.round(n))}return m.push({handle:++d,callback:t,cancelled:!1}),d},h=function(t){for(var e=0;e<m.length;e++)m[e].handle===t&&(m[e].cancelled=!0)}}n.exports=function(t){return p?l.call(i,function(){try{t.apply(this,arguments)}catch(e){setTimeout(function(){throw e},0)}}):l.call(i,t)},n.exports.cancel=function(){h.apply(i,arguments)}}],["index.js","rezult","index.js",{},function(t,e,n,r,s){"use strict";function o(t,e){var n=this;n.err=t||null,n.value=e}n.exports=o,o.prototype.toValue=function(){var t=this;if(t.err)throw t.err;return t.value},o.prototype.toCallback=function(t){var e=this;t(e.err,e.value)},o.just=function(t){return new o(null,t)},o.error=function(t){return new o(t,null)},o.lift=function(t){return function(){try{return o.just(t.apply(this,arguments))}catch(e){return o.error(e)}}}}],["dom.js","wizdom","dom.js",{},function(t,e,n,r,s){"use strict";function o(t){this.doctype=null,this.documentElement=null,this.namespaceURI=t||""}function i(t){this.ownerDocument=t,this.parentNode=null,this.firstChild=null,this.lastChild=null,this.previousSibling=null,this.nextSibling=null}function a(t,e){i.call(this,t),this.data=e}function u(t,e){i.call(this,t),this.data=e}function l(t,e,n){i.call(this,t),this.tagName=e,this.namespaceURI=n,this.attributes=new this.ownerDocument.NamedNodeMap}function h(t,e,n){this.ownerDocument=t,this.name=e,this.value=null,this.namespaceURI=n}function p(){this.length=0}n.exports=o,o.prototype.nodeType=9,o.prototype.Node=i,o.prototype.Element=l,o.prototype.TextNode=a,o.prototype.Comment=u,o.prototype.Attr=h,o.prototype.NamedNodeMap=p,o.prototype.createTextNode=function(t){return new this.TextNode(this,t)},o.prototype.createComment=function(t){return new this.Comment(this,t)},o.prototype.createElement=function(t,e){return new this.Element(this,t,e||this.namespaceURI)},o.prototype.createElementNS=function(t,e){return new this.Element(this,e,t||this.namespaceURI)},o.prototype.createAttribute=function(t,e){return new this.Attr(this,t,e||this.namespaceURI)},o.prototype.createAttributeNS=function(t,e){return new this.Attr(this,e,t||this.namespaceURI)},i.prototype.appendChild=function(t){return this.insertBefore(t,null)},i.prototype.insertBefore=function(t,e){if(!t)throw new Error("Can't insert null child");if(t.ownerDocument!==this.ownerDocument)throw new Error("Can't insert child from foreign document");t.parentNode&&t.parentNode.removeChild(t);var n;n=e?e.previousSibling:this.lastChild,n&&(n.nextSibling=t),e&&(e.previousSibling=t),t.nextSibling=e,t.previousSibling=n,t.parentNode=this,e||(this.lastChild=t),n||(this.firstChild=t)},i.prototype.removeChild=function(t){if(!t)throw new Error("Can't remove null child");var e=t.parentNode;if(e!==this)throw new Error("Can't remove node that is not a child of parent");return t===e.firstChild&&(e.firstChild=t.nextSibling),t===e.lastChild&&(e.lastChild=t.previousSibling),t.previousSibling&&(t.previousSibling.nextSibling=t.nextSibling),t.nextSibling&&(t.nextSibling.previousSibling=t.previousSibling),t.previousSibling=null,t.parentNode=null,t.nextSibling=null,t},a.prototype=Object.create(i.prototype),a.prototype.constructor=a,a.prototype.nodeType=3,u.prototype=Object.create(i.prototype),u.prototype.constructor=u,u.prototype.nodeType=8,l.prototype=Object.create(i.prototype),l.prototype.constructor=l,l.prototype.nodeType=1,l.prototype.hasAttribute=function(t,e){var n=this.attributes.getNamedItem(t,e);return!!n},l.prototype.getAttribute=function(t,e){var n=this.attributes.getNamedItem(t,e);return n?n.value:null},l.prototype.setAttribute=function(t,e,n){var r=this.ownerDocument.createAttribute(t,n);r.value=e,this.attributes.setNamedItem(r,n)},l.prototype.removeAttribute=function(t,e){this.attributes.removeNamedItem(t,e)},l.prototype.hasAttributeNS=function(t,e){return this.hasAttribute(e,t)},l.prototype.getAttributeNS=function(t,e){return this.getAttribute(e,t)},l.prototype.setAttributeNS=function(t,e,n){this.setAttribute(e,n,t)},l.prototype.removeAttributeNS=function(t,e){this.removeAttribute(e,t)},h.prototype.nodeType=2,p.prototype.getNamedItem=function(t,e){e=e||"";var n=encodeURIComponent(e)+":"+encodeURIComponent(t);return this[n]},p.prototype.setNamedItem=function(t){var e=t.namespaceURI||"",n=t.name,r=encodeURIComponent(e)+":"+encodeURIComponent(n),s=this[r];return s||(this[this.length]=t,this.length++,s=null),this[r]=t,s},p.prototype.removeNamedItem=function(t,e){e=e||"";var n=encodeURIComponent(e)+":"+encodeURIComponent(t),r=this[n];if(!r)throw new Error("Not found");var s=Array.prototype.indexOf.call(this,r);delete this[n],delete this[s],this.length--},p.prototype.item=function(t){return this[t]},p.prototype.getNamedItemNS=function(t,e){return this.getNamedItem(e,t)},p.prototype.setNamedItemNS=function(t){return this.setNamedItem(t)},p.prototype.removeNamedItemNS=function(t,e){return this.removeNamedItem(e,t)}}]])("hexant/index.js");
